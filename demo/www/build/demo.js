(()=>{var t={837:function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return n(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.computeFieldOfView=void 0;const s=a(i(175)),o=a(i(327)),l=i(878),h=i(785),u=i(273),c=i(888);function d(t,e,i,r,n,a,u){const c=[s.CardinalDirection.NORTH,s.CardinalDirection.SOUTH][(n+1)/2],d=[s.CardinalDirection.WEST,s.CardinalDirection.EAST][(r+1)/2],f=[h.TileFlags.WALL_NORTH,h.TileFlags.WALL_SOUTH][(n+1)/2],p=[h.TileFlags.WALL_WEST,h.TileFlags.WALL_EAST][(r+1)/2];let _=l.initWedges(u);for(let e=0;e<=i;e++){const s=e*n;for(let n=0;n<=i;n++){const i=n*r,u=(n-.5)/(e+.5),g=(n+.5)/(e+.5),T=0!==e?n/e:Number.POSITIVE_INFINITY,O=0!==e?(n+.5)/(e-.5):Number.POSITIVE_INFINITY;{const e=l.getBestWedge(_,u,T,O);t.warps[t.visible.index(i,s)]=e.warp,e.shadow&&t.visible.set(i,s,!1)}const v=[];for(const t of _){if(t.low>=O||t.high<=u){v.push(t);continue}const r=t.warp,_=r.map,T=r.shiftX+i,y=r.shiftY+s;if(!_.contains(T,y)){v.push(t);continue}const S=_.index(T,y),m=_.getTileFlagsAtIndex(S),w=_.getWarpAtIndex(S,c),D=_.getWarpAtIndex(S,d),A=!w&&0!=(m&f),F=!D&&0!=(m&p);let E;E=A&&F?l.addShadow(t,u-o.WALL_OUTSET,O+o.WALL_OUTSET):0===n&&0===e||0==(m&h.TileFlags.BODY)?A?l.addShadow(t,u-o.WALL_OUTSET,g+o.WALL_OUTSET):F?l.addShadow(t,g-o.WALL_OUTSET,O+o.WALL_OUTSET):[t]:A?l.addShadow(t,u-o.WALL_OUTSET,O-o.BODY_INSET):F?l.addShadow(t,u+o.BODY_INSET,O+o.WALL_OUTSET):l.addShadow(t,u+o.BODY_INSET,O-o.BODY_INSET);for(const t of E)if(w&&D){const e=a.get(w.map,r.warpCount+1,r.shiftX+w.offsetShift.x,r.shiftY+w.offsetShift.y),i=l.addWarp(t,e,u-o.WARP_OUTSET,g),n=a.get(D.map,r.warpCount+1,r.shiftX+D.offsetShift.x,r.shiftY+D.offsetShift.y);for(const t of i)v.push(...l.addWarp(t,n,g,O+o.WARP_OUTSET))}else if(w){const e=a.get(w.map,r.warpCount+1,r.shiftX+w.offsetShift.x,r.shiftY+w.offsetShift.y);v.push(...l.addWarp(t,e,u-o.WARP_OUTSET,g+o.WARP_OUTSET))}else if(D){const e=a.get(D.map,r.warpCount+1,r.shiftX+D.offsetShift.x,r.shiftY+D.offsetShift.y);v.push(...l.addWarp(t,e,g-o.WARP_OUTSET,O+o.WARP_OUTSET))}else v.push(t)}_=l.mergeWedges(v)}}}e.computeFieldOfView=function(t,e,i,r){if(!t.contains(e,i))throw new Error("origin is not on the map");const n=new s.Offset(e,i),a=new u.FieldOfViewImpl(t,n,r),o=new c.WarpDataCache,l=o.get(t,0,e,i);return d(a,0,r,-1,-1,o,l),d(a,0,r,1,-1,o,l),d(a,0,r,-1,1,o,l),d(a,0,r,1,1,o,l),a}},327:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PICK_WEDGE_EPSILON=e.WARP_OUTSET=e.WALL_OUTSET=e.BODY_INSET=void 0,e.BODY_INSET=1e-5,e.WALL_OUTSET=e.BODY_INSET/4,e.WARP_OUTSET=e.WALL_OUTSET/4,e.PICK_WEDGE_EPSILON=2*e.WALL_OUTSET},273:function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return n(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.FieldOfViewImpl=void 0;const s=a(i(175));e.FieldOfViewImpl=class{constructor(t,e,i){this.map=t,this.origin=e,this.chebyshevRadius=i;const r=new s.Rectangle(-i,-i,2*i+1,2*i+1);this.visible=new s.MaskRectangle(r,!0),this.visible.set(0,0,!0),this.warps=new Array(r.area)}getVisible(t,e){return this.visible.get(t,e)}getTargetMap(t,e){return this._getWarp(t,e).map}getTargetOffset(t,e){const i=this._getWarp(t,e);return{x:i.shiftX+t,y:i.shiftY+e}}toString(){let t="";for(let e=-this.chebyshevRadius;e<=this.chebyshevRadius;e++){for(let i=-this.chebyshevRadius;i<=this.chebyshevRadius;i++)0===i&&0===e?t+="@":this.getVisible(i,e)?t+=this._getWarp(i,e).map.id[0]:t+=".";t+="\n"}return t}_getWarp(t,e){return this.warps[this.visible.index(t,e)]}}},522:function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return n(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.FieldOfViewMap=void 0;const s=a(i(175)),o=i(785),l=new s.Offset;e.FieldOfViewMap=class{constructor(t,e,i,r=!1){if(this._size=new s.Size,this._warps=new Array,this.id=t,this._size.set(e,i),this._tileFlags=new Array(this._size.area).fill(0),r){for(let t=0;t<this._size.height;t++)this._addFlag(0,t,o.TileFlags.WALL_WEST),this._addFlag(this._size.width-1,t,o.TileFlags.WALL_EAST);for(let t=0;t<this._size.width;t++)this._addFlag(t,0,o.TileFlags.WALL_NORTH),this._addFlag(t,this._size.height-1,o.TileFlags.WALL_SOUTH)}this._tileWarpIds=s.CARDINAL_DIRECTIONS.map((()=>new Array(this._size.area).fill(-1)))}get width(){return this._size.width}get height(){return this._size.height}addBody(t,e){return this._addFlag(t,e,o.TileFlags.BODY),this}removeBody(t,e){return this._removeFlag(t,e,o.TileFlags.BODY),this}getBody(t,e){const i=this.index(t,e);return 0!=(this._tileFlags[i]&o.TileFlags.BODY)}addWall(t,e,i,r=!1){return this._addFlag(t,e,1<<i),l.set(t,e),l.addCardinalDirection(i),!r&&this._size.containsOffset(l)&&this._addFlag(l.x,l.y,1<<s.cardinalDirectionOpposite(i)),this}removeWall(t,e,i,r=!1){return this._removeFlag(t,e,1<<i),l.set(t,e),l.addCardinalDirection(i),!r&&this._size.containsOffset(l)&&this._removeFlag(l.x,l.y,1<<s.cardinalDirectionOpposite(i)),this}getWalls(t,e){const i=this.index(t,e);return this._tileFlags[i]&s.CardinalDirectionFlags.ALL}getWall(t,e,i){return 0!=(this.getWalls(t,e)&1<<i)}addWarp(t,e,i,r,n,a,o){if(!o){l.set(t-n,e-a).addCardinalDirection(i);const o=r._findOrMakeWarp(this,l);r._addWarp(n,a,s.cardinalDirectionOpposite(i),o)}l.set(n-t,a-e).addCardinalDirection(s.cardinalDirectionOpposite(i));const h=this._findOrMakeWarp(r,l);return this._addWarp(t,e,i,h),this}removeWarp(t,e,i,r=!1){if(!r){const r=this._getWarp(t,e,i);if(!r)return this;l.set(t,e).addCardinalDirection(i).addOffset(r.offsetShift),r.map._removeWarp(l.x,l.y,s.cardinalDirectionOpposite(i))}return this._removeWarp(t,e,i),this}getWarpFlags(t,e){let i=s.CardinalDirectionFlags.NONE;return s.CARDINAL_DIRECTIONS.forEach((r=>{this._getWarp(t,e,r)&&(i=s.cardinalDirectionFlagsSetCardinalDirection(i,r))})),i}getWarpFlag(t,e,i){return!!this._getWarp(t,e,i)}getWarpTargetMap(t,e,i){var r;return null===(r=this._getWarp(t,e,i))||void 0===r?void 0:r.map}getWarpTargetOffset(t,e,i){var r;const n=null===(r=this._getWarp(t,e,i))||void 0===r?void 0:r.offsetShift;if(n)return l.copyFrom(n).add(t,e).addCardinalDirection(i),{x:l.x,y:l.y}}index(t,e){return this._size.index(t,e)}_addFlag(t,e,i){const r=this.index(t,e);this._tileFlags[r]|=i}_removeFlag(t,e,i){const r=this.index(t,e);this._tileFlags[r]&=~i}_makeWarp(t,e,i){const r=this._warps.length;return this._warps.push({map:t,offsetShift:new s.Offset(e,i)}),r}_findOrMakeWarp(t,e){for(let i=0;i<this._warps.length;i++){const r=this._warps[i];if(r.map===t&&r.offsetShift.equals(e))return i}return this._makeWarp(t,e.x,e.y)}_addWarp(t,e,i,r){const n=this.index(t,e);this._tileWarpIds[i][n]=r}_removeWarp(t,e,i){const r=this.index(t,e);delete this._tileWarpIds[i][r]}_getWarp(t,e,i){const r=this.index(t,e);return this.getWarpAtIndex(r,i)}contains(t,e){return this._size.contains(t,e)}getTileFlagsAtIndex(t){return this._tileFlags[t]}getWarpAtIndex(t,e){const i=this._tileWarpIds[e][t];return-1===i?void 0:this._warps[i]}}},254:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Offset=e.CardinalDirectionFlags=e.CardinalDirection=e.computeFieldOfView=e.FieldOfViewMap=void 0;var r=i(522);Object.defineProperty(e,"FieldOfViewMap",{enumerable:!0,get:function(){return r.FieldOfViewMap}});var n=i(837);Object.defineProperty(e,"computeFieldOfView",{enumerable:!0,get:function(){return n.computeFieldOfView}});var a=i(175);Object.defineProperty(e,"CardinalDirection",{enumerable:!0,get:function(){return a.CardinalDirection}}),Object.defineProperty(e,"CardinalDirectionFlags",{enumerable:!0,get:function(){return a.CardinalDirectionFlags}}),Object.defineProperty(e,"Offset",{enumerable:!0,get:function(){return a.Offset}})},785:function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return n(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.TileFlags=void 0;const s=a(i(175));var o;(o=e.TileFlags||(e.TileFlags={}))[o.NONE=0]="NONE",o[o.WALL_NORTH=1]="WALL_NORTH",o[o.WALL_EAST=2]="WALL_EAST",o[o.WALL_WEST=8]="WALL_WEST",o[o.WALL_SOUTH=4]="WALL_SOUTH",o[o.BODY=1<<s.CARDINAL_DIRECTIONS.length]="BODY"},888:(t,e)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.WarpDataCache=void 0,e.WarpDataCache=class{constructor(){this._data={}}get(t,e,i,r){let n=this._data[t.id];n||(this._data[t.id]=n={});let a=n[e];a||(n[e]=a={});let s=a[r];s||(a[r]=s={});let o=s[i];return o||(s[i]=o={map:t,warpCount:e,shiftX:i,shiftY:r},o)}}},878:function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return n(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.mergeWedges=e.addWarp=e.addShadow=e.getBestWedge=e.initWedges=void 0;const s=a(i(327));e.initWedges=function(t){return[{low:0,high:Number.POSITIVE_INFINITY,shadow:!1,warp:t}]},e.getBestWedge=function(t,e,i,r){let n,a=Number.POSITIVE_INFINITY;for(const c of t){if(c.low>=r)break;if(c.high<=e)continue;const t=Math.max(i-c.high,c.low-i);n&&(l=c,h=a,u=t,!((o=n).shadow!==l.shadow?o.shadow:!(u>h+s.PICK_WEDGE_EPSILON)&&(h>u+s.PICK_WEDGE_EPSILON||(l.warp.warpCount!==o.warp.warpCount?l.warp.warpCount<o.warp.warpCount:l.warp.map.id!==o.warp.map.id?l.warp.map.id<o.warp.map.id:l.warp.shiftY!==o.warp.shiftY?l.warp.shiftY<o.warp.shiftY:l.warp.shiftX!==o.warp.shiftX&&l.warp.shiftX<o.warp.shiftX))))||(n=c,a=t)}var o,l,h,u;if(!n)throw new Error("[bug] no wedge found");return n},e.addShadow=function(t,e,i){if(t.shadow||i<=t.low||e>=t.high)return[t];if(e<=t.low){if(i>=t.high)return t.shadow=!0,[t];{const e=Object.assign(Object.assign({},t),{shadow:!0,high:i});return t.low=i,[e,t]}}if(i>=t.high){const i=Object.assign(Object.assign({},t),{shadow:!0,low:e});return t.high=e,[t,i]}return[Object.assign(Object.assign({},t),{high:e}),Object.assign(Object.assign({},t),{shadow:!0,low:e,high:i}),Object.assign(Object.assign({},t),{low:i})]},e.addWarp=function(t,e,i,r){if(t.warp===e||r<=t.low||i>=t.high)return[t];if(i<=t.low){if(r>=t.high)return t.warp=e,[t];{const i=Object.assign(Object.assign({},t),{warp:e,high:r});return t.low=r,[i,t]}}if(r>=t.high){const r=Object.assign(Object.assign({},t),{warp:e,low:i});return t.high=i,[t,r]}return[Object.assign(Object.assign({},t),{high:i}),Object.assign(Object.assign({},t),{warp:e,low:i,high:r}),Object.assign(Object.assign({},t),{low:r})]},e.mergeWedges=function(t){if(0===t.length)throw new Error("[bug] no wedges");if(1===t.length)return t;const e=[];for(const n of t)0===e.length||(r=n,(i=e[e.length-1]).shadow!==r.shadow||i.warp!==r.warp)?e.push(n):e[e.length-1].high=n.high;var i,r;return e}},695:(t,e,i)=>{var r={},n=i(525),a=i(549),s=i(251);t.exports=r;var o=1;r.js=function(){var t,e,i,l=1.4,h=!1,u={},c={},d={},f={},p=!0,_={},g=[],T=Number.MAX_VALUE,O=!1;this.setAcceptableTiles=function(t){t instanceof Array?i=t:!isNaN(parseFloat(t))&&isFinite(t)&&(i=[t])},this.enableSync=function(){h=!0},this.disableSync=function(){h=!1},this.enableDiagonals=function(){O=!0},this.disableDiagonals=function(){O=!1},this.setGrid=function(e){t=e;for(var i=0;i<t.length;i++)for(var r=0;r<t[0].length;r++)c[t[i][r]]||(c[t[i][r]]=1)},this.setTileCost=function(t,e){c[t]=e},this.setAdditionalPointCost=function(t,e,i){void 0===d[e]&&(d[e]={}),d[e][t]=i},this.removeAdditionalPointCost=function(t,e){void 0!==d[e]&&delete d[e][t]},this.removeAllAdditionalPointCosts=function(){d={}},this.setDirectionalCondition=function(t,e,i){void 0===f[e]&&(f[e]={}),f[e][t]=i},this.removeAllDirectionalConditions=function(){f={}},this.setIterationsPerCalculation=function(t){T=t},this.avoidAdditionalPoint=function(t,e){void 0===u[e]&&(u[e]={}),u[e][t]=1},this.stopAvoidingAdditionalPoint=function(t,e){void 0!==u[e]&&delete u[e][t]},this.enableCornerCutting=function(){p=!0},this.disableCornerCutting=function(){p=!1},this.stopAvoidingAllAdditionalPoints=function(){u={}},this.findPath=function(e,r,a,l,u){var c=function(t){h?u(t):setTimeout((function(){u(t)}))};if(void 0===i)throw new Error("You can't set a path without first calling setAcceptableTiles() on EasyStar.");if(void 0===t)throw new Error("You can't set a path without first calling setGrid() on EasyStar.");if(e<0||r<0||a<0||l<0||e>t[0].length-1||r>t.length-1||a>t[0].length-1||l>t.length-1)throw new Error("Your start or end point is outside the scope of your grid.");if(e!==a||r!==l){for(var d=t[l][a],f=!1,p=0;p<i.length;p++)if(d===i[p]){f=!0;break}if(!1!==f){var T=new n;T.openList=new s((function(t,e){return t.bestGuessDistance()-e.bestGuessDistance()})),T.isDoneCalculating=!1,T.nodeHash={},T.startX=e,T.startY=r,T.endX=a,T.endY=l,T.callback=c,T.openList.push(w(T,T.startX,T.startY,null,1));var O=o++;return _[O]=T,g.push(O),O}c(null)}else c([])},this.cancelPath=function(t){return t in _&&(delete _[t],!0)},this.calculate=function(){if(0!==g.length&&void 0!==t&&void 0!==i)for(e=0;e<T;e++){if(0===g.length)return;h&&(e=0);var r=g[0],n=_[r];if(void 0!==n)if(0!==n.openList.size()){var a=n.openList.pop();if(n.endX!==a.x||n.endY!==a.y)a.list=0,a.y>0&&v(n,a,0,-1,1*m(a.x,a.y-1)),a.x<t[0].length-1&&v(n,a,1,0,1*m(a.x+1,a.y)),a.y<t.length-1&&v(n,a,0,1,1*m(a.x,a.y+1)),a.x>0&&v(n,a,-1,0,1*m(a.x-1,a.y)),O&&(a.x>0&&a.y>0&&(p||y(t,i,a.x,a.y-1,a)&&y(t,i,a.x-1,a.y,a))&&v(n,a,-1,-1,l*m(a.x-1,a.y-1)),a.x<t[0].length-1&&a.y<t.length-1&&(p||y(t,i,a.x,a.y+1,a)&&y(t,i,a.x+1,a.y,a))&&v(n,a,1,1,l*m(a.x+1,a.y+1)),a.x<t[0].length-1&&a.y>0&&(p||y(t,i,a.x,a.y-1,a)&&y(t,i,a.x+1,a.y,a))&&v(n,a,1,-1,l*m(a.x+1,a.y-1)),a.x>0&&a.y<t.length-1&&(p||y(t,i,a.x,a.y+1,a)&&y(t,i,a.x-1,a.y,a))&&v(n,a,-1,1,l*m(a.x-1,a.y+1)));else{var s=[];s.push({x:a.x,y:a.y});for(var o=a.parent;null!=o;)s.push({x:o.x,y:o.y}),o=o.parent;s.reverse();var u=s;n.callback(u),delete _[r],g.shift()}}else n.callback(null),delete _[r],g.shift();else g.shift()}};var v=function(e,r,n,a,s){var o=r.x+n,l=r.y+a;if((void 0===u[l]||void 0===u[l][o])&&y(t,i,o,l,r)){var h=w(e,o,l,r,s);void 0===h.list?(h.list=1,e.openList.push(h)):r.costSoFar+s<h.costSoFar&&(h.costSoFar=r.costSoFar+s,h.parent=r,e.openList.updateItem(h))}},y=function(t,e,i,r,n){var a=f[r]&&f[r][i];if(a){var s=S(n.x-i,n.y-r);if(!function(){for(var t=0;t<a.length;t++)if(a[t]===s)return!0;return!1}())return!1}for(var o=0;o<e.length;o++)if(t[r][i]===e[o])return!0;return!1},S=function(t,e){if(0===t&&-1===e)return r.TOP;if(1===t&&-1===e)return r.TOP_RIGHT;if(1===t&&0===e)return r.RIGHT;if(1===t&&1===e)return r.BOTTOM_RIGHT;if(0===t&&1===e)return r.BOTTOM;if(-1===t&&1===e)return r.BOTTOM_LEFT;if(-1===t&&0===e)return r.LEFT;if(-1===t&&-1===e)return r.TOP_LEFT;throw new Error("These differences are not valid: "+t+", "+e)},m=function(e,i){return d[i]&&d[i][e]||c[t[i][e]]},w=function(t,e,i,r,n){if(void 0!==t.nodeHash[i]){if(void 0!==t.nodeHash[i][e])return t.nodeHash[i][e]}else t.nodeHash[i]={};var s=D(e,i,t.endX,t.endY);if(null!==r)var o=r.costSoFar+n;else o=0;var l=new a(r,e,i,o,s);return t.nodeHash[i][e]=l,l},D=function(t,e,i,r){var n,a;return O?(n=Math.abs(t-i))<(a=Math.abs(e-r))?l*n+a:l*a+n:(n=Math.abs(t-i))+(a=Math.abs(e-r))}},r.TOP="TOP",r.TOP_RIGHT="TOP_RIGHT",r.RIGHT="RIGHT",r.BOTTOM_RIGHT="BOTTOM_RIGHT",r.BOTTOM="BOTTOM",r.BOTTOM_LEFT="BOTTOM_LEFT",r.LEFT="LEFT",r.TOP_LEFT="TOP_LEFT"},525:t=>{t.exports=function(){this.pointsToAvoid={},this.startX,this.callback,this.startY,this.endX,this.endY,this.nodeHash={},this.openList}},549:t=>{t.exports=function(t,e,i,r,n){this.parent=t,this.x=e,this.y=i,this.costSoFar=r,this.simpleDistanceToTarget=n,this.bestGuessDistance=function(){return this.costSoFar+this.simpleDistanceToTarget}}},251:(t,e,i)=>{t.exports=i(208)},208:function(t,e){var i,r,n;(function(){var a,s,o,l,h,u,c,d,f,p,_,g,T,O,v;o=Math.floor,p=Math.min,s=function(t,e){return t<e?-1:t>e?1:0},f=function(t,e,i,r,n){var a;if(null==i&&(i=0),null==n&&(n=s),i<0)throw new Error("lo must be non-negative");for(null==r&&(r=t.length);i<r;)n(e,t[a=o((i+r)/2)])<0?r=a:i=a+1;return[].splice.apply(t,[i,i-i].concat(e)),e},u=function(t,e,i){return null==i&&(i=s),t.push(e),O(t,0,t.length-1,i)},h=function(t,e){var i,r;return null==e&&(e=s),i=t.pop(),t.length?(r=t[0],t[0]=i,v(t,0,e)):r=i,r},d=function(t,e,i){var r;return null==i&&(i=s),r=t[0],t[0]=e,v(t,0,i),r},c=function(t,e,i){var r;return null==i&&(i=s),t.length&&i(t[0],e)<0&&(e=(r=[t[0],e])[0],t[0]=r[1],v(t,0,i)),e},l=function(t,e){var i,r,n,a,l,h;for(null==e&&(e=s),l=[],r=0,n=(a=function(){h=[];for(var e=0,i=o(t.length/2);0<=i?e<i:e>i;0<=i?e++:e--)h.push(e);return h}.apply(this).reverse()).length;r<n;r++)i=a[r],l.push(v(t,i,e));return l},T=function(t,e,i){var r;if(null==i&&(i=s),-1!==(r=t.indexOf(e)))return O(t,0,r,i),v(t,r,i)},_=function(t,e,i){var r,n,a,o,h;if(null==i&&(i=s),!(n=t.slice(0,e)).length)return n;for(l(n,i),a=0,o=(h=t.slice(e)).length;a<o;a++)r=h[a],c(n,r,i);return n.sort(i).reverse()},g=function(t,e,i){var r,n,a,o,u,c,d,_,g;if(null==i&&(i=s),10*e<=t.length){if(!(a=t.slice(0,e).sort(i)).length)return a;for(n=a[a.length-1],o=0,c=(d=t.slice(e)).length;o<c;o++)i(r=d[o],n)<0&&(f(a,r,0,null,i),a.pop(),n=a[a.length-1]);return a}for(l(t,i),g=[],u=0,_=p(e,t.length);0<=_?u<_:u>_;0<=_?++u:--u)g.push(h(t,i));return g},O=function(t,e,i,r){var n,a,o;for(null==r&&(r=s),n=t[i];i>e&&r(n,a=t[o=i-1>>1])<0;)t[i]=a,i=o;return t[i]=n},v=function(t,e,i){var r,n,a,o,l;for(null==i&&(i=s),n=t.length,l=e,a=t[e],r=2*e+1;r<n;)(o=r+1)<n&&!(i(t[r],t[o])<0)&&(r=o),t[e]=t[r],r=2*(e=r)+1;return t[e]=a,O(t,l,e,i)},a=function(){function t(t){this.cmp=null!=t?t:s,this.nodes=[]}return t.push=u,t.pop=h,t.replace=d,t.pushpop=c,t.heapify=l,t.updateItem=T,t.nlargest=_,t.nsmallest=g,t.prototype.push=function(t){return u(this.nodes,t,this.cmp)},t.prototype.pop=function(){return h(this.nodes,this.cmp)},t.prototype.peek=function(){return this.nodes[0]},t.prototype.contains=function(t){return-1!==this.nodes.indexOf(t)},t.prototype.replace=function(t){return d(this.nodes,t,this.cmp)},t.prototype.pushpop=function(t){return c(this.nodes,t,this.cmp)},t.prototype.heapify=function(){return l(this.nodes,this.cmp)},t.prototype.updateItem=function(t){return T(this.nodes,t,this.cmp)},t.prototype.clear=function(){return this.nodes=[]},t.prototype.empty=function(){return 0===this.nodes.length},t.prototype.size=function(){return this.nodes.length},t.prototype.clone=function(){var e;return(e=new t).nodes=this.nodes.slice(0),e},t.prototype.toArray=function(){return this.nodes.slice(0)},t.prototype.insert=t.prototype.push,t.prototype.top=t.prototype.peek,t.prototype.front=t.prototype.peek,t.prototype.has=t.prototype.contains,t.prototype.copy=t.prototype.clone,t}(),r=[],void 0===(n="function"==typeof(i=function(){return a})?i.apply(e,r):i)||(t.exports=n)}).call(this)},680:(t,e,i)=>{var r;!function(){"use strict";var n=.5*(Math.sqrt(3)-1),a=(3-Math.sqrt(3))/6,s=1/6,o=(Math.sqrt(5)-1)/4,l=(5-Math.sqrt(5))/20;function h(t){var e;e="function"==typeof t?t:t?function(){var t=0,e=0,i=0,r=1,n=c();t=n(" "),e=n(" "),i=n(" ");for(var a=0;a<arguments.length;a++)(t-=n(arguments[a]))<0&&(t+=1),(e-=n(arguments[a]))<0&&(e+=1),(i-=n(arguments[a]))<0&&(i+=1);return n=null,function(){var n=2091639*t+2.3283064365386963e-10*r;return t=e,e=i,i=n-(r=0|n)}}(t):Math.random,this.p=u(e),this.perm=new Uint8Array(512),this.permMod12=new Uint8Array(512);for(var i=0;i<512;i++)this.perm[i]=this.p[255&i],this.permMod12[i]=this.perm[i]%12}function u(t){var e,i=new Uint8Array(256);for(e=0;e<256;e++)i[e]=e;for(e=0;e<255;e++){var r=e+~~(t()*(256-e)),n=i[e];i[e]=i[r],i[r]=n}return i}function c(){var t=4022871197;return function(e){e=e.toString();for(var i=0;i<e.length;i++){var r=.02519603282416938*(t+=e.charCodeAt(i));r-=t=r>>>0,t=(r*=t)>>>0,t+=4294967296*(r-=t)}return 2.3283064365386963e-10*(t>>>0)}}h.prototype={grad3:new Float32Array([1,1,0,-1,1,0,1,-1,0,-1,-1,0,1,0,1,-1,0,1,1,0,-1,-1,0,-1,0,1,1,0,-1,1,0,1,-1,0,-1,-1]),grad4:new Float32Array([0,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,1,0,1,1,1,0,1,-1,1,0,-1,1,1,0,-1,-1,-1,0,1,1,-1,0,1,-1,-1,0,-1,1,-1,0,-1,-1,1,1,0,1,1,1,0,-1,1,-1,0,1,1,-1,0,-1,-1,1,0,1,-1,1,0,-1,-1,-1,0,1,-1,-1,0,-1,1,1,1,0,1,1,-1,0,1,-1,1,0,1,-1,-1,0,-1,1,1,0,-1,1,-1,0,-1,-1,1,0,-1,-1,-1,0]),noise2D:function(t,e){var i,r,s=this.permMod12,o=this.perm,l=this.grad3,h=0,u=0,c=0,d=(t+e)*n,f=Math.floor(t+d),p=Math.floor(e+d),_=(f+p)*a,g=t-(f-_),T=e-(p-_);g>T?(i=1,r=0):(i=0,r=1);var O=g-i+a,v=T-r+a,y=g-1+2*a,S=T-1+2*a,m=255&f,w=255&p,D=.5-g*g-T*T;if(D>=0){var A=3*s[m+o[w]];h=(D*=D)*D*(l[A]*g+l[A+1]*T)}var F=.5-O*O-v*v;if(F>=0){var E=3*s[m+i+o[w+r]];u=(F*=F)*F*(l[E]*O+l[E+1]*v)}var x=.5-y*y-S*S;if(x>=0){var b=3*s[m+1+o[w+1]];c=(x*=x)*x*(l[b]*y+l[b+1]*S)}return 70*(h+u+c)},noise3D:function(t,e,i){var r,n,a,o,l,h,u,c,d,f,p=this.permMod12,_=this.perm,g=this.grad3,T=.3333333333333333*(t+e+i),O=Math.floor(t+T),v=Math.floor(e+T),y=Math.floor(i+T),S=(O+v+y)*s,m=t-(O-S),w=e-(v-S),D=i-(y-S);m>=w?w>=D?(l=1,h=0,u=0,c=1,d=1,f=0):m>=D?(l=1,h=0,u=0,c=1,d=0,f=1):(l=0,h=0,u=1,c=1,d=0,f=1):w<D?(l=0,h=0,u=1,c=0,d=1,f=1):m<D?(l=0,h=1,u=0,c=0,d=1,f=1):(l=0,h=1,u=0,c=1,d=1,f=0);var A=m-l+s,F=w-h+s,E=D-u+s,x=m-c+2*s,b=w-d+2*s,C=D-f+2*s,W=m-1+.5,M=w-1+.5,H=D-1+.5,R=255&O,N=255&v,I=255&y,L=.6-m*m-w*w-D*D;if(L<0)r=0;else{var P=3*p[R+_[N+_[I]]];r=(L*=L)*L*(g[P]*m+g[P+1]*w+g[P+2]*D)}var j=.6-A*A-F*F-E*E;if(j<0)n=0;else{var U=3*p[R+l+_[N+h+_[I+u]]];n=(j*=j)*j*(g[U]*A+g[U+1]*F+g[U+2]*E)}var Y=.6-x*x-b*b-C*C;if(Y<0)a=0;else{var z=3*p[R+c+_[N+d+_[I+f]]];a=(Y*=Y)*Y*(g[z]*x+g[z+1]*b+g[z+2]*C)}var X=.6-W*W-M*M-H*H;if(X<0)o=0;else{var k=3*p[R+1+_[N+1+_[I+1]]];o=(X*=X)*X*(g[k]*W+g[k+1]*M+g[k+2]*H)}return 32*(r+n+a+o)},noise4D:function(t,e,i,r){var n,a,s,h,u,c,d,f,p,_,g,T,O,v,y,S,m,w=this.perm,D=this.grad4,A=(t+e+i+r)*o,F=Math.floor(t+A),E=Math.floor(e+A),x=Math.floor(i+A),b=Math.floor(r+A),C=(F+E+x+b)*l,W=t-(F-C),M=e-(E-C),H=i-(x-C),R=r-(b-C),N=0,I=0,L=0,P=0;W>M?N++:I++,W>H?N++:L++,W>R?N++:P++,M>H?I++:L++,M>R?I++:P++,H>R?L++:P++;var j=W-(c=N>=3?1:0)+l,U=M-(d=I>=3?1:0)+l,Y=H-(f=L>=3?1:0)+l,z=R-(p=P>=3?1:0)+l,X=W-(_=N>=2?1:0)+2*l,k=M-(g=I>=2?1:0)+2*l,B=H-(T=L>=2?1:0)+2*l,V=R-(O=P>=2?1:0)+2*l,$=W-(v=N>=1?1:0)+3*l,q=M-(y=I>=1?1:0)+3*l,G=H-(S=L>=1?1:0)+3*l,K=R-(m=P>=1?1:0)+3*l,J=W-1+4*l,Q=M-1+4*l,Z=H-1+4*l,tt=R-1+4*l,et=255&F,it=255&E,rt=255&x,nt=255&b,at=.6-W*W-M*M-H*H-R*R;if(at<0)n=0;else{var st=w[et+w[it+w[rt+w[nt]]]]%32*4;n=(at*=at)*at*(D[st]*W+D[st+1]*M+D[st+2]*H+D[st+3]*R)}var ot=.6-j*j-U*U-Y*Y-z*z;if(ot<0)a=0;else{var lt=w[et+c+w[it+d+w[rt+f+w[nt+p]]]]%32*4;a=(ot*=ot)*ot*(D[lt]*j+D[lt+1]*U+D[lt+2]*Y+D[lt+3]*z)}var ht=.6-X*X-k*k-B*B-V*V;if(ht<0)s=0;else{var ut=w[et+_+w[it+g+w[rt+T+w[nt+O]]]]%32*4;s=(ht*=ht)*ht*(D[ut]*X+D[ut+1]*k+D[ut+2]*B+D[ut+3]*V)}var ct=.6-$*$-q*q-G*G-K*K;if(ct<0)h=0;else{var dt=w[et+v+w[it+y+w[rt+S+w[nt+m]]]]%32*4;h=(ct*=ct)*ct*(D[dt]*$+D[dt+1]*q+D[dt+2]*G+D[dt+3]*K)}var ft=.6-J*J-Q*Q-Z*Z-tt*tt;if(ft<0)u=0;else{var pt=w[et+1+w[it+1+w[rt+1+w[nt+1]]]]%32*4;u=(ft*=ft)*ft*(D[pt]*J+D[pt+1]*Q+D[pt+2]*Z+D[pt+3]*tt)}return 27*(n+a+s+h+u)}},h._buildPermutationTable=u,void 0===(r=function(){return h}.call(e,i,e,t))||(t.exports=r),e.SimplexNoise=h,t.exports=h}()},586:(t,e)=>{"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.axisAddCardinalTurn=e.axisFromNorthSouthTurn=e.axisFromCardinalDirection=e.axisOrthogonal=e.axisToString=e.AXES=e.Axis=void 0,function(t){t[t.NORTH_SOUTH=0]="NORTH_SOUTH",t[t.WEST_EAST=1]="WEST_EAST"}(i=e.Axis||(e.Axis={})),e.AXES=[i.NORTH_SOUTH,i.WEST_EAST];const r=["N-S","W-E"];e.axisToString=function(t){return r[t]},e.axisOrthogonal=function(t){return 1^t},e.axisFromCardinalDirection=function(t){return 1&t},e.axisFromNorthSouthTurn=function(t){return 1&t},e.axisAddCardinalTurn=function(t,e){return t+e&1}},450:(t,e)=>{"use strict";var i;function r(t){return 1<<t}Object.defineProperty(e,"__esModule",{value:!0}),e.cardinalDirectionFlagsFromCardinalDirection=e.cardinalDirectionFlagsRemoveCardinalDirection=e.cardinalDirectionFlagsSetCardinalDirection=e.cardinalDirectionFlagsHasCardinalDirection=e.cardinalDirectionFlagsToString=e.CardinalDirectionFlags=void 0,function(t){t[t.NONE=0]="NONE",t[t.NORTH=1]="NORTH",t[t.EAST=2]="EAST",t[t.SOUTH=4]="SOUTH",t[t.WEST=8]="WEST",t[t.ALL=15]="ALL"}(i=e.CardinalDirectionFlags||(e.CardinalDirectionFlags={})),e.cardinalDirectionFlagsToString=function(t){let e="[";return 0!=(t&i.NORTH)&&(e+="N"),0!=(t&i.EAST)&&(e+="E"),0!=(t&i.SOUTH)&&(e+="S"),0!=(t&i.WEST)&&(e+="W"),e+"]"},e.cardinalDirectionFlagsHasCardinalDirection=function(t,e){return 0!=(t&r(e))},e.cardinalDirectionFlagsSetCardinalDirection=function(t,e){return t|r(e)},e.cardinalDirectionFlagsRemoveCardinalDirection=function(t,e){return t&~r(e)},e.cardinalDirectionFlagsFromCardinalDirection=r},28:(t,e)=>{"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.cardinalDirectionAddCardinalTurn=e.cardinalDirectionFromCardinalOrientation=e.cardinalDirectionFromNorthTurn=e.cardinalDirectionFromDirection=e.cardinalDirectionOpposite=e.cardinalDirectionToString=e.CARDINAL_DIRECTIONS=e.CardinalDirection=void 0,function(t){t[t.NORTH=0]="NORTH",t[t.EAST=1]="EAST",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST"}(i=e.CardinalDirection||(e.CardinalDirection={})),e.CARDINAL_DIRECTIONS=[i.NORTH,i.EAST,i.SOUTH,i.WEST];const r=["N","E","S","W"];e.cardinalDirectionToString=function(t){return r[t]},e.cardinalDirectionOpposite=function(t){return t+2&3},e.cardinalDirectionFromDirection=function(t){return t>>1},e.cardinalDirectionFromNorthTurn=function(t){return t},e.cardinalDirectionFromCardinalOrientation=function(t){return t>>>1},e.cardinalDirectionAddCardinalTurn=function(t,e){return t+e&3}},534:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.cardinalOrientationAddCardinalTurn=e.cardinalOrientationFromFlipAndCardinalDirection=e.cardinalOrientationReverse=e.cardinalOrientationFlip=e.cardinalOrientationToString=e.CARDINAL_ORIENTATIONS=e.CardinalOrientation=void 0;const r=i(586),n=i(598);var a;!function(t){t[t.HEADS_NORTH=0]="HEADS_NORTH",t[t.TAILS_NORTH=1]="TAILS_NORTH",t[t.HEADS_EAST=2]="HEADS_EAST",t[t.TAILS_EAST=3]="TAILS_EAST",t[t.HEADS_SOUTH=4]="HEADS_SOUTH",t[t.TAILS_SOUTH=5]="TAILS_SOUTH",t[t.HEADS_WEST=6]="HEADS_WEST",t[t.TAILS_WEST=7]="TAILS_WEST"}(a=e.CardinalOrientation||(e.CardinalOrientation={})),e.CARDINAL_ORIENTATIONS=[a.HEADS_NORTH,a.TAILS_NORTH,a.HEADS_EAST,a.TAILS_EAST,a.HEADS_SOUTH,a.TAILS_SOUTH,a.HEADS_WEST,a.TAILS_WEST];const s=["HN","TN","HE","TE","HS","TS","HW","TW"];e.cardinalOrientationToString=function(t){return s[t]},e.cardinalOrientationFlip=function(t,e){return e===r.Axis.NORTH_SOUTH?9-t&7:13-t&7},e.cardinalOrientationReverse=function(t){return t===a.HEADS_EAST?a.HEADS_WEST:t===a.HEADS_WEST?a.HEADS_EAST:t},e.cardinalOrientationFromFlipAndCardinalDirection=function(t,e){return 2*e+(t!==n.Flip.HEADS?1:0)},e.cardinalOrientationAddCardinalTurn=function(t,e){return t+2*e&7}},399:(t,e)=>{"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.cardinalTurnAddCardinalTurn=e.cardinalTurnFromTurn=e.cardinalTurnFromCardinalDirections=e.cardinalTurnReverse=e.cardinalTurnToDegrees=e.cardinalTurnToString=e.CARDINAL_TURNS=e.CardinalTurn=void 0,function(t){t[t.NONE=0]="NONE",t[t.RIGHT=1]="RIGHT",t[t.AROUND=2]="AROUND",t[t.LEFT=3]="LEFT"}(i=e.CardinalTurn||(e.CardinalTurn={})),e.CARDINAL_TURNS=[i.NONE,i.RIGHT,i.AROUND,i.LEFT];const r=["T0","T+90","T180","T-90"];e.cardinalTurnToString=function(t){return r[t]},e.cardinalTurnToDegrees=function(t){return 90*t},e.cardinalTurnReverse=function(t){return 4-t&3},e.cardinalTurnFromCardinalDirections=function(t,e){return e-t&3},e.cardinalTurnFromTurn=function(t){return t>>1},e.cardinalTurnAddCardinalTurn=function(t,e){return t+e&3}},730:(t,e)=>{"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.directionAddCardinalTurn=e.directionAddTurn=e.directionFromCardinalDirection=e.directionOpposite=e.directionIsCardinal=e.directionToString=e.DIRECTIONS=e.Direction=void 0,function(t){t[t.NORTH=0]="NORTH",t[t.NORTHEAST=1]="NORTHEAST",t[t.EAST=2]="EAST",t[t.SOUTHEAST=3]="SOUTHEAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTHWEST=5]="SOUTHWEST",t[t.WEST=6]="WEST",t[t.NORTHWEST=7]="NORTHWEST"}(i=e.Direction||(e.Direction={})),e.DIRECTIONS=[i.NORTH,i.NORTHEAST,i.EAST,i.SOUTHEAST,i.SOUTH,i.SOUTHWEST,i.WEST,i.NORTHWEST];const r=["N","NE","E","SE","S","SW","W","NW"];e.directionToString=function(t){return r[t]},e.directionIsCardinal=function(t){return 0==(1&t)},e.directionOpposite=function(t){return t+4&7},e.directionFromCardinalDirection=function(t){return t<<1},e.directionAddTurn=function(t,e){return t+e&7},e.directionAddCardinalTurn=function(t,e){return t+2*e&7}},598:(t,e)=>{"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.flipFromCardinalOrientation=e.flipFromBoolean=e.flipOpposite=e.flipToString=e.FLIPS=e.Flip=void 0,function(t){t[t.HEADS=0]="HEADS",t[t.TAILS=1]="TAILS"}(i=e.Flip||(e.Flip={})),e.FLIPS=[i.HEADS,i.TAILS];const r=["H","T"];e.flipToString=function(t){return r[t]},e.flipOpposite=function(t){return 1^t},e.flipFromBoolean=function(t){return t?i.TAILS:i.HEADS},e.flipFromCardinalOrientation=function(t){return 1&t}},74:function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),n=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),n(i(730),e),n(i(35),e),n(i(28),e),n(i(399),e),n(i(450),e),n(i(598),e),n(i(534),e),n(i(586),e)},35:(t,e)=>{"use strict";var i;Object.defineProperty(e,"__esModule",{value:!0}),e.turnAddTurn=e.turnFromDirections=e.turnFromCardinalTurn=e.turnFromCardinalDirections=e.turnReverse=e.turnIsCardinal=e.turnToDegrees=e.turnToString=e.TURNS=e.Turn=void 0,function(t){t[t.NONE=0]="NONE",t[t.R_45=1]="R_45",t[t.R_90=2]="R_90",t[t.R_135=3]="R_135",t[t.T_180=4]="T_180",t[t.L_135=5]="L_135",t[t.L_90=6]="L_90",t[t.L_45=7]="L_45"}(i=e.Turn||(e.Turn={})),e.TURNS=[i.NONE,i.R_45,i.R_90,i.R_135,i.T_180,i.L_135,i.L_90,i.L_45];const r=["T0","T+45","T+90","T+135","T180","T-135","T-90","T-45"];e.turnToString=function(t){return r[t]},e.turnToDegrees=function(t){return 45*t},e.turnIsCardinal=function(t){return 0==(1&t)},e.turnReverse=function(t){return 8-t&7},e.turnFromCardinalDirections=function(t,e){return 2*(e-t)&7},e.turnFromCardinalTurn=function(t){return t<<1},e.turnFromDirections=function(t,e){return e-t&7},e.turnAddTurn=function(t,e){return t+e&7}},400:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.CardinalPath=void 0;const r=i(74),n=i(317),a=i(82),s=i(64),o=new n.Offset;function l(t,e){t.push(e);let i=t.length-1;for(;i>0&&e<t[i-1];)t[i]=t[i-1],i--;t[i]=e}e.CardinalPath=class{constructor(t,e){this._start=new n.Offset,this._start.copyFrom(t),this._segments=e}toString(){return`${this._start.toString()}:${this._segments.map((t=>r.cardinalDirectionToString(t))).join("")}`}equals(t){return this._start.equals(t._start)&&this._segments.length===t._segments.length&&this._segments.every(((e,i)=>e===t._segments[i]))}get length(){return this._segments.length}getIsClosed(){o.copyFrom(this._start);for(const t of this._segments)o.addCardinalDirection(t);return this._start.equals(o)}*offsets(){let{x:t,y:e}=this._start;yield{x:t,y:e};for(const i of this._segments)o.setFromCardinalDirection(i),t+=o.x,e+=o.y,yield{x:t,y:e}}getBounds(){let t=this._start.y,e=t,i=this._start.x,n=i;o.copyFrom(this._start);for(const a of this._segments)switch(o.addCardinalDirection(a),a){case r.CardinalDirection.NORTH:t=Math.min(t,o.y);break;case r.CardinalDirection.EAST:n=Math.max(n,o.x);break;case r.CardinalDirection.SOUTH:e=Math.max(e,o.y);break;case r.CardinalDirection.WEST:i=Math.min(i,o.x);break;default:throw new Error(`bad direction ${a} in cardinal path`)}return new a.Rectangle(i,t,n-i+1,e-t+1)}getArea(){let t=0;o.copyFrom(this._start);for(const e of this._segments)switch(o.addCardinalDirection(e),e){case r.CardinalDirection.NORTH:t-=o.x;break;case r.CardinalDirection.SOUTH:t+=o.x}return Math.abs(t)}rasterize(t){const e=new Array;void 0===t&&(t=this.getBounds()),o.copyFrom(this._start);const{northY:i}=t,n=i+t.height-1;for(let t=i;t<n;t++)e.push([]);o.copyFrom(this._start);for(const t of this._segments)t===r.CardinalDirection.SOUTH&&l(e[o.y-i],o.x),o.addCardinalDirection(t),t===r.CardinalDirection.NORTH&&l(e[o.y-i],o.x);return new s.RasterMask({westX:t.westX,northY:t.northY,width:t.width-1,height:t.height-1},e)}}},876:function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),n=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),n(i(317),e),n(i(154),e),n(i(82),e),n(i(971),e),n(i(630),e),n(i(64),e),n(i(400),e),n(i(457),e)},630:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.MaskRectangle=void 0;const r=i(82),n=i(971);e.MaskRectangle=class{constructor(t,e=!1,i=!1){this._rect=new r.Rectangle,void 0!==t&&this._rect.copyFrom(t),this._mask=new n.Mask(t,e),this._outsideValue=i}toString(){return`${this._rect.northWest}/${this._outsideValue}\n${this._mask}`}equals(t){return this._rect.equals(t._rect)&&this._mask.equals(t._mask)&&this._outsideValue===t._outsideValue}get westX(){return this._rect.westX}get northY(){return this._rect.northY}get width(){return this._rect.width}get height(){return this._rect.height}get(t,e){return this._rect.contains(t,e)?this._mask.get(t-this.westX,e-this.northY):this._outsideValue}getAtIndex(t){return this._mask.getAtIndex(t)}getAtOffset(t){return this.get(t.x,t.y)}copyFrom(t){return this._rect.copyFrom(t._rect),this._mask.copyFrom(t._mask),this._outsideValue=t._outsideValue,this}set(t,e,i){return this._mask.set(t-this.westX,e-this.northY,i),this}setAtOffset(t,e){return this.set(t.x,t.y,e)}setAtIndex(t,e){return this._mask.setAtIndex(t,e),this}index(t,e){return this._mask.index(t-this.westX,e-this.northY)}*locations(){for(const t of this._mask.locations()){const e=t.x+this.westX,i=t.y+this.northY,{value:r}=t;yield{x:e,y:i,value:r}}}*offsetsWithTrue(){for(const t of this._mask.offsetsWithTrue()){const e=t.x+this.westX,i=t.y+this.northY;yield{x:e,y:i}}}}},971:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Mask=void 0;const r=i(154);e.Mask=class{constructor(t,e=!1){this._size=new r.Size,void 0!==t&&this._size.copyFrom(t),this._bits=new Array(Math.ceil(this._size.area/32)).fill(e?4294967295:0)}toString(){let t="";for(let e=0;e<this.height;e++){for(let i=0;i<this.width;i++)t+=this.get(i,e)?"☑":"☐";t+="\n"}return t}equals(t){return this._size.equals(t._size)&&this._bits.length===t._bits.length&&this._bits.every(((e,i)=>e===t._bits[i]))}get width(){return this._size.width}get height(){return this._size.height}get(t,e){return this.getAtIndex(this.index(t,e))}getAtOffset(t){return this.get(t.x,t.y)}getAtIndex(t){const e=t>>>5,i=1<<(31&t);return 0!=(this._bits[e]&i)}copyFrom(t){return this._size.copyFrom(t._size),this._bits=t._bits.slice(),this}set(t,e,i){return this.setAtIndex(this.index(t,e),i)}setAtOffset(t,e){return this.set(t.x,t.y,e)}setAtIndex(t,e){const i=t>>>5,r=1<<(31&t);return e?this._bits[i]|=r:this._bits[i]&=~r,this}index(t,e){return this._size.index(t,e)}*locations(){let t=0,e=1;for(const{x:i,y:r}of this._size.offsets()){const n=0!=(this._bits[t]&e);yield{x:i,y:r,value:n},e===1<<31?(e=1,t++):e<<=1}}*offsetsWithTrue(){for(const{x:t,y:e,value:i}of this.locations())i&&(yield{x:t,y:e})}}},317:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Offset=void 0;const r=i(74),n=[0,1,1,1,0,-1,-1,-1],a=[-1,-1,0,1,1,1,0,-1],s=[0,1,0,-1],o=[-1,0,1,0];e.Offset=class{constructor(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}toString(){return`(${this.x},${this.y})`}equals(t){return this.x===t.x&&this.y===t.y}set(t,e){return this.x=t,this.y=e,this}copyFrom(t){return this.set(t.x,t.y)}setFromDirection(t){return this.set(n[t],a[t])}setFromCardinalDirection(t){return this.set(s[t],o[t])}add(t,e){return this.x+=t,this.y+=e,this}addSize(t){return this.add(t.width,t.height)}addOffset(t){return this.add(t.x,t.y)}addDirection(t){return this.add(n[t],a[t])}addCardinalDirection(t){return this.add(s[t],o[t])}subtractOffset(t){return this.add(-t.x,-t.y)}multiply(t){return this.x*=t,this.y*=t,this}rotate(t,e){if(e)return this.subtractOffset(e).rotate(t).addOffset(e);{const e=r.cardinalDirectionFromNorthTurn(t),{x:i,y:n}=this,a=s[e],l=o[e],h=-n*a-i*l,u=i*a-n*l;return this.set(h,u)}}distanceChebyshev(t){return Math.max(Math.abs(this.x-t.x),Math.abs(this.y-t.y))}distanceManhattan(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}*nearbyChebyshevOffsets(t,e){if(e>=0)for(let i=-e;i<=e;i++)for(let r=-e;r<=e;r++)yield t.set(this.x+r,this.y+i)}}},64:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RasterMask=void 0;const r=i(82);e.RasterMask=class{constructor(t,e){if(this._rect=new r.Rectangle,e.length!==t.height)throw new Error(`bad lines array length ${e.length} for bounds ${t}`);this._rect.copyFrom(t),this._lines=e}toString(){let t="";const{eastX:e}=this._rect;for(let i=0;i<this.height;i++){const r=this._lines[i];let n=this.westX;for(let e=0;e<r.length;e+=2){const i=r[e],a=r[e+1];for(;n<i;)t+="∙",n++;for(;n<a;)t+="█",n++}for(;n<=e;)t+="∙",n++;t+="\n"}return`(${this._rect.westX},${this._rect.northY})\n${t}`}equals(t){return this._rect.equals(t._rect)&&this._lines.length===t._lines.length&&this._lines.every(((e,i)=>e.length===t._lines[i].length&&e.every(((e,r)=>e===t._lines[i][r]))))}get northY(){return this._rect.northY}get southY(){return this._rect.southY}get westX(){return this._rect.westX}get width(){return this._rect.width}get height(){return this._rect.height}get(t,e){if(e<this.northY||e>this._rect.southY)return!1;const i=this._lines[e-this.northY];for(let e=0;e<i.length;e+=2)if(t>=i[e]&&t<i[e+1])return!0;return!1}getAtOffset(t){return this.get(t.x,t.y)}*bandsAt(t){if(t>=this.northY&&t<=this._rect.southY){const e=this._lines[t-this.northY];for(let t=0;t<e.length;t+=2)yield{westX:e[t],eastX:e[t+1]-1}}}}},82:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Rectangle=void 0;const r=i(154),n=i(317),a=[0,0,1,1],s=[0,1,1,0];e.Rectangle=class{constructor(t,e,i,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===a&&(a=0),this.northWest=new n.Offset(t,e),this.size=new r.Size(i,a)}toString(){return`(${this.westX},${this.northY} ${this.width}x${this.height})`}equals(t){return this.westX===t.westX&&this.northY===t.northY&&this.size.equals(t)}get northY(){return this.northWest.y}get southY(){return this.northWest.y+this.size.height-1}get westX(){return this.northWest.x}get eastX(){return this.northWest.x+this.size.width-1}get width(){return this.size.width}get height(){return this.size.height}get empty(){return this.size.empty}get area(){return this.size.area}set(t,e,i,r){return this.northWest.set(t,e),this.size.set(i,r),this}setFromCorners(t,e){const i=Math.min(t.x,e.x),r=Math.max(t.x,e.x),n=Math.min(t.y,e.y),a=Math.max(t.y,e.y);return this.set(i,n,r-i+1,a-n+1)}copyFrom(t){return this.set(t.westX,t.northY,t.width,t.height)}addOffset(t){return this.northWest.addOffset(t),this}scale(t){return this.northWest.multiply(t),this.size.multiply(t),this}rotate(t,e){const i=a[t],r=s[t];return this.northWest.add(i*(this.width-1),r*(this.height-1)).rotate(t,e),this.size.rotate(t),this}extendToInclude(t){const e=t.x-this.westX;e<0?(this.size.width-=e,this.northWest.x=t.x):e>=this.size.width&&(this.size.width=e+1);const i=t.y-this.northWest.y;return i<0?(this.size.height-=i,this.northWest.y=t.y):i>=this.size.height&&(this.size.height=i+1),this}contains(t,e){return this.size.contains(t-this.westX,e-this.northY)}index(t,e){return this.size.index(t-this.westX,e-this.northY)}containsOffset(t){return this.contains(t.x,t.y)}containsRectangle(t){if(0===t.width&&0===t.height)return!1;const e=t.westX-this.westX,i=t.northY-this.northY;return!!this.size.contains(e,i)&&this.size.contains(e+t.width-1,i+t.height-1)}overlapsRectangle(t){return this.northY<=t.northY+t.height-1&&this.southY>=t.northY&&this.westX<=t.westX+t.width-1&&this.eastX>=t.westX&&!this.empty&&0!==t.width&&0!==t.height}*offsets(){const{eastX:t,southY:e}=this;for(let i=this.northY;i<=e;i++)for(let e=this.westX;e<=t;e++)yield{x:e,y:i}}anyOf(t){for(const{x:e,y:i}of this.offsets())if(t(e,i))return!0;return!1}}},154:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Size=void 0;const r=i(74);e.Size=class{constructor(t,e){if(void 0===t&&(t=0),void 0===e&&(e=0),t<0||e<0)throw new Error(`bad size (${t}x${e})`);this.width=t,this.height=e}toString(){return`(${this.width}x${this.height})`}equals(t){return this.width===t.width&&this.height===t.height}get empty(){return 0===this.width||0===this.height}get area(){return this.width*this.height}set(t,e){if(t<0||e<0)throw new Error(`bad size (${t}x${e})`);return this.width=t,this.height=e,this}copyFrom(t){return this.set(t.width,t.height)}add(t,e){return this.width+=t,this.height+=e,this}multiply(t){return this.width*=t,this.height*=t,this}rotate(t){return r.axisFromNorthSouthTurn(t)===r.Axis.WEST_EAST&&this.set(this.height,this.width),this}contains(t,e){return t>=0&&e>=0&&t<this.width&&e<this.height}containsOffset(t){return this.contains(t.x,t.y)}index(t,e){return e*this.width+t}*offsets(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)yield{x:e,y:t}}anyOf(t){for(const{x:e,y:i}of this.offsets())if(t(e,i))return!0;return!1}}},457:(t,e,i)=>{"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TransformRectangle=void 0;const r=i(82),n=i(74),a=i(317),s=i(154),o=new a.Offset,l=new a.Offset,h=new s.Size;e.TransformRectangle=class{constructor(t,e){this._size=new s.Size,this._flip=n.Flip.HEADS,this._rotate=n.CardinalTurn.NONE,this._translate=new a.Offset,this._matrix=[1,0,0,0,1,0],this._targetRect=new r.Rectangle,void 0===t||("number"==typeof t?this._size.set(t,e):this._size.copyFrom(t)),this._update()}toString(){return`[${this._size} -> ${n.flipToString(this._flip)} ${n.cardinalTurnToString(this._rotate)} ${this._translate} -> ${this._targetRect}]`}equals(t){return this._size.equals(t._size)&&this._flip===t._flip&&this._rotate===t._rotate&&this._translate.equals(t._translate)}get flip(){return this._flip}get rotate(){return this._rotate}get northY(){return this._translate.y}get southY(){return this._translate.y+this._targetRect.height-1}get westX(){return this._translate.x}get eastX(){return this._translate.x+this._targetRect.width-1}get width(){return this._targetRect.width}get height(){return this._targetRect.height}_update(){o.setFromCardinalDirection(n.cardinalDirectionFromNorthTurn(this._rotate));const t=this._flip===n.Flip.TAILS?-1:1;switch(this._matrix[0]=-o.y*t,this._matrix[1]=-o.x,this._matrix[2]=this._translate.x,this._matrix[3]=o.x*t,this._matrix[4]=-o.y,this._matrix[5]=this._translate.y,this._rotate){case n.CardinalTurn.NONE:this._flip===n.Flip.TAILS&&(this._matrix[2]+=this._size.width-1);break;case n.CardinalTurn.RIGHT:this._matrix[2]+=this._size.height-1,this._flip===n.Flip.TAILS&&(this._matrix[5]+=this._size.width-1);break;case n.CardinalTurn.AROUND:this._matrix[5]+=this._size.height-1,this._flip===n.Flip.HEADS&&(this._matrix[2]+=this._size.width-1);break;case n.CardinalTurn.LEFT:this._flip===n.Flip.HEADS&&(this._matrix[5]+=this._size.width-1)}return h.copyFrom(this._size).rotate(this._rotate),this._targetRect.set(this._translate.x,this._translate.y,h.width,h.height),this}copyFrom(t){return this._size.copyFrom(t._size),this._flip=t._flip,this._rotate=t._rotate,this._translate.copyFrom(t._translate),t._matrix.forEach(((t,e)=>this._matrix[e]=t)),this._targetRect.copyFrom(t._targetRect),this}reset(){return this._flip=n.Flip.HEADS,this._rotate=n.CardinalTurn.NONE,this._translate.set(0,0),this._update()}invert(){const t=n.cardinalTurnFromCardinalDirections(n.CardinalDirection.NORTH,n.cardinalDirectionFromCardinalOrientation(n.cardinalOrientationReverse(n.cardinalOrientationFromFlipAndCardinalDirection(this._flip,n.cardinalDirectionFromNorthTurn(this._rotate)))));return this._rotate=t,this._size.rotate(t),this._translate.multiply(-1),this._update()}setTransform(t,e,i){return this._flip=t,this._rotate=e,this._translate.copyFrom(i),this._update()}setFlip(t){return this._flip=t,this._update()}setRotate(t){return this._rotate=t,this._update()}setTranslate(t,e){return this._translate.set(t,e),this._update()}setTranslateOffset(t){return this._translate.copyFrom(t),this._update()}applyToCardinalOrientation(t){return this._flip===n.Flip.TAILS&&(t=n.cardinalOrientationFlip(t,n.Axis.NORTH_SOUTH)),n.cardinalOrientationAddCardinalTurn(t,this._rotate)}unapplyFromCardinalOrientation(t){return t=n.cardinalOrientationAddCardinalTurn(t,n.cardinalTurnReverse(this._rotate)),this._flip===n.Flip.TAILS&&(t=n.cardinalOrientationFlip(t,n.Axis.NORTH_SOUTH)),t}applyToCardinalDirection(t){return n.cardinalDirectionFromCardinalOrientation(this.applyToCardinalOrientation(n.cardinalOrientationFromFlipAndCardinalDirection(n.Flip.HEADS,t)))}unapplyFromCardinalDirection(t){return n.cardinalDirectionFromCardinalOrientation(this.unapplyFromCardinalOrientation(n.cardinalOrientationFromFlipAndCardinalDirection(n.Flip.HEADS,t)))}applyTo(t,e,i){const r=e*this._matrix[0]+i*this._matrix[1]+this._matrix[2],n=e*this._matrix[3]+i*this._matrix[4]+this._matrix[5];return t.set(r,n)}unapplyFrom(t,e,i){const r=e-this._matrix[2],n=i-this._matrix[5],a=r*this._matrix[0]+n*this._matrix[3],s=r*this._matrix[1]+n*this._matrix[4];return t.set(a,s)}applyToOffset(t,e){return void 0===e&&(e=t),this.applyTo(t,e.x,e.y)}unapplyFromOffset(t,e){return void 0===e&&(e=t),this.unapplyFrom(t,e.x,e.y)}applyToRectangle(t,e){return void 0!==e&&t.copyFrom(e),o.set(t.westX,t.northY),l.set(t.eastX,t.southY),this.applyToOffset(o),this.applyToOffset(l),t.setFromCorners(o,l)}unapplyFromRectangle(t,e){return void 0!==e&&t.copyFrom(e),o.set(t.westX,t.northY),l.set(t.eastX,t.southY),this.unapplyFromOffset(o),this.unapplyFromOffset(l),t.setFromCorners(o,l)}}},175:function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),n=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),n(i(74),e),n(i(876),e)},725:function(t,e,i){"use strict";var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),a=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return n(e,t),e},s=this&&this.__read||function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var r,n,a=i.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=a.next()).done;)s.push(r.value)}catch(t){n={error:t}}finally{try{r&&!r.done&&(i=a.return)&&i.call(a)}finally{if(n)throw n.error}}return s},o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var l,h,u,c=a(i(254)),d=a(i(695)),f=o(i(680)),p=document.getElementById("canvas").getContext("2d"),_=37,g=19,T=new Array;function O(t,e){return e*_+t}function v(t){for(var e=new c.FieldOfViewMap(t,_,g,!0),i=.1,r="0"===e.id?60:"1"===e.id?9:3,n=0;n<r;n++){var a=Math.floor(35*Math.random()+1),s=Math.floor(17*Math.random()+1);if(!e.getWalls(a,s))for(var o=Math.floor(4*Math.random()),l="0"===e.id?Math.floor(5*Math.random()+1):Math.floor(7*Math.random()+5),u=0;u<l&&!(a<1||a>=36||s<1||s>=18);u++){e.addWall(a,s,o);var d=Math.random();switch(o){case c.CardinalDirection.NORTH:d<i?(o=c.CardinalDirection.WEST,a++,s--):d>.9?o=c.CardinalDirection.EAST:a++;break;case c.CardinalDirection.EAST:d<i?(o=c.CardinalDirection.NORTH,a++,s++):d>.9?o=c.CardinalDirection.SOUTH:s++;break;case c.CardinalDirection.SOUTH:d<i?(o=c.CardinalDirection.EAST,a--,s++):d>.9?o=c.CardinalDirection.WEST:a--;break;case c.CardinalDirection.WEST:d<i?(o=c.CardinalDirection.SOUTH,a--,s--):d>.9?o=c.CardinalDirection.NORTH:s--}}}var f="0"===e.id?.04:.08;for(s=0;s<g;s++){var p=void 0;for("2"===e.id&&(p=new Array,T.push(p)),a=0;a<_;a++){var O=e.getWalls(a,s);"2"===e.id?null==p||p.push(h.noise2D(a/4,s/4)<-.4):0===O&&Math.random()<f&&e.addBody(a,s)}}return e}function y(t,e){var i=[c.CardinalDirection.NORTH,c.CardinalDirection.EAST,c.CardinalDirection.SOUTH,c.CardinalDirection.WEST][Math.floor(4*Math.random())];if(i===c.CardinalDirection.NORTH||i===c.CardinalDirection.SOUTH){for(var r=Math.floor(29*Math.random()+2),n=Math.floor(15*Math.random()+2),a=i===c.CardinalDirection.NORTH?n-1:n+1,s=0;s<4;s++)if(t.getWarpFlags(r+s,n)||e.getWarpFlags(r+s,a))return void y(t,e);for(t.addWall(r,n,c.CardinalDirection.WEST),e.addWall(r,a,c.CardinalDirection.WEST),s=0;s<4;s++)"2"===t.id&&(T[n][r]=!1),t.removeBody(r,n),t.removeWall(r,n,c.CardinalDirection.NORTH),t.removeWall(r,n,c.CardinalDirection.EAST),t.removeWall(r,n,c.CardinalDirection.SOUTH),"2"===e.id&&(T[a][r]=!1),e.removeBody(r,a),e.removeWall(r,a,c.CardinalDirection.NORTH),e.removeWall(r,a,c.CardinalDirection.EAST),e.removeWall(r,a,c.CardinalDirection.SOUTH),t.addWarp(r,n,i,e,r,a),e.addWarp(r,a,i+2&3,t,r,n),t.addWall(r,a,i+2&3,!0),e.addWall(r,n,i,!0),r+=1;t.addWall(r-1,n,c.CardinalDirection.EAST),e.addWall(r-1,a,c.CardinalDirection.EAST)}else{r=Math.floor(33*Math.random()+2),n=Math.floor(11*Math.random()+2);var o=i===c.CardinalDirection.WEST?r-1:r+1;for(s=0;s<4;s++)if(t.getWarpFlags(r,n+s)||e.getWarpFlags(o,n+s))return void y(t,e);for(t.addWall(r,n,c.CardinalDirection.NORTH),e.addWall(o,n,c.CardinalDirection.NORTH),s=0;s<4;s++)"2"===t.id&&(T[n][r]=!1),t.removeBody(r,n),t.removeWall(r,n,c.CardinalDirection.EAST),t.removeWall(r,n,c.CardinalDirection.SOUTH),t.removeWall(r,n,c.CardinalDirection.WEST),"2"===e.id&&(T[n][o]=!1),e.removeBody(o,n),e.removeWall(o,n,c.CardinalDirection.EAST),e.removeWall(o,n,c.CardinalDirection.SOUTH),e.removeWall(o,n,c.CardinalDirection.WEST),t.addWarp(r,n,i,e,o,n),e.addWarp(o,n,i+2&3,t,r,n),t.addWall(o,n,i+2&3,!0),e.addWall(r,n,i,!0),n+=1;t.addWall(r,n-1,c.CardinalDirection.SOUTH),e.addWall(o,n-1,c.CardinalDirection.SOUTH)}}function S(){var t,e,i=Math.floor(Math.random()*u.length);do{t=Math.floor(Math.random()*_),e=Math.floor(Math.random()*g)}while(u[i].getWalls(t,e)||u[i].getBody(t,e)||u[i].getWarpFlags(t,e));return[i,t,e]}var m,w,D,A=new Array(703);function F(t,e,i,r){p.drawImage(C,64*b[t],64*e,64,64,32*i-16,32*r-16,64,64)}function E(){p.fillStyle="#666",p.fillRect(0,0,1184,608);for(var t=c.computeFieldOfView(u[m],w,D,15),e=0;e<g;e++)for(var i=0;i<_;i++){var r=i-w,n=e-D,a=t.getVisible(r,n)?t.getTargetMap(r,n):u[m],s=parseInt(a.id);p.fillStyle=0===s?"#aaf":1===s?"#afa":"#faa",p.fillRect(32*i,32*e,32,32),F("floor"+Math.floor(1+6*A[O(i,e)]),s,i,e)}for(e=0;e<g;e++)for(i=0;i<_;i++){r=i-w,n=e-D,a=t.getVisible(r,n)?t.getTargetMap(r,n):u[m];var o=t.getVisible(r,n)?t.getTargetOffset(r,n):new c.Offset(i,e);s=parseInt(a.id),a.getBody(o.x,o.y)&&F("box"+Math.floor(1+3*A[O(i,e)]),s,i,e),2===s&&T[o.y][o.x]&&F("box"+Math.floor(1+3*A[O(i,e)]),s,i,e)}for(e=0;e<g;e++)for(i=0;i<_;i++){r=i-w,n=e-D,a=t.getVisible(r,n)?t.getTargetMap(r,n):u[m],o=t.getVisible(r,n)?t.getTargetOffset(r,n):new c.Offset(i,e),s=parseInt(a.id);var l=a.getWalls(o.x,o.y);0!=(l&c.CardinalDirectionFlags.NORTH)&&F("north",s,i,e),0!=(l&c.CardinalDirectionFlags.EAST)&&F("east",s,i,e),0!=(l&c.CardinalDirectionFlags.SOUTH)&&F("south",s,i,e),0!=(l&c.CardinalDirectionFlags.WEST)&&F("west",s,i,e)}for(e=0;e<g;e++)for(i=0;i<_;i++){r=i-w,n=e-D,a=t.getVisible(r,n)?t.getTargetMap(r,n):u[m],o=t.getVisible(r,n)?t.getTargetOffset(r,n):new c.Offset(i,e),s=parseInt(a.id);var h=a.getWarpFlags(o.x,o.y);0!=(h&c.CardinalDirectionFlags.NORTH)&&F("warpnorth",s,i,e),0!=(h&c.CardinalDirectionFlags.EAST)&&F("warpeast",s,i,e),0!=(h&c.CardinalDirectionFlags.SOUTH)&&F("warpsouth",s,i,e),0!=(h&c.CardinalDirectionFlags.WEST)&&F("warpwest",s,i,e)}for(e=0;e<g;e++)for(i=0;i<_;i++)r=i-w,n=e-D,a=t.getVisible(r,n)?t.getTargetMap(r,n):u[m],s=parseInt(a.id),t.getVisible(r,n)||F("shadow",s,i,e);return F("player",m,w,D),t}var x=!0;window.addEventListener("keydown",(function(t){var e;if("ArrowUp"===t.key||"ArrowDown"===t.key||"ArrowLeft"===t.key||"ArrowRight"===t.key){var i=c.computeFieldOfView(u[m],w,D,15),r=w,n=D,a=void 0;switch(t.key){case"ArrowUp":a=c.CardinalDirection.NORTH,n--;break;case"ArrowDown":a=c.CardinalDirection.SOUTH,n++;break;case"ArrowLeft":a=c.CardinalDirection.WEST,r--;break;case"ArrowRight":a=c.CardinalDirection.EAST,r++}if(r>=0&&n>=0&&r<_&&n<g&&!u[m].getWall(w,D,a)){var s=r-w,o=n-D,l=i.getTargetMap(s,o);l.getBody(r,n)||(2===(m=parseInt(l.id))&&T[n][r]||(w=r,D=n),requestAnimationFrame(E))}t.preventDefault(),x=!1,null===(e=document.getElementById("takeover"))||void 0===e||e.remove()}}));var b={floor1:0,floor2:1,floor3:2,floor4:3,floor5:4,floor6:5,box1:6,box2:7,box3:8,north:9,east:10,south:11,west:12,warpnorth:13,warpeast:14,warpsouth:15,warpwest:16,player:17,shadow:18},C=new Image;C.src="./tiles.png",C.onload=function(){!function(){var t;h=new f.default,function(){u=new Array;for(var t=0;t<3;t++)u.push(v(String(t)));for(t=0;t<3;t++)for(var e=t+1;e<3;e++)y(u[t],u[e]),y(u[t],u[e]),y(u[t],u[e])}(),t=s(S(),3),m=t[0],w=t[1],D=t[2];for(var e=0;e<g;e++)for(var i=0;i<_;i++)A[O(i,e)]=Math.random()}();var t,e=!1,i=0;requestAnimationFrame((function r(){if(x){var n=E();if(t)if(t.length>0){var a=t.shift();a&&(N=a.x,H=a.y,A=N-w,F=H-D,n.getVisible(A,F)&&(I=n.getTargetMap(A,F),parseInt(I.id)!==m&&(m=parseInt(I.id),t=void 0),w=N,D=H))}else t=void 0;else if(e)l.calculate();else{i++;for(var o=new Array,h=String(m),f=String((m+1)%u.length),p=0;p<100&&o.length<20;p++){var O=s(S(),3),v=O[1],y=O[2],A=v-w,F=y-D;if(n.getVisible(A,F)){var b=n.getTargetMap(A,F);if(b.getBody(v,y))continue;if("2"===b.id&&T[y][v])continue;var C=0;i<3?b.id===h&&(C+=10):b.id===f?(C+=20,i=0):b.id!==h&&(C+=10,i=0),(w-18.5)*(y-9.5)-(v-18.5)*(D-9.5)<0&&(C+=5),C+=Math.min(10,Math.max(Math.abs(w-v),Math.abs(D-y)))/10,o.push({nx:v,ny:y,score:C})}}if(o.length>0){o.sort((function(t,e){return e.score-t.score}));var W=o[0];v=W.nx,y=W.ny,(l=new d.js).setAcceptableTiles([0]);for(var M=new Array,H=0;H<g;H++){var R=new Array;M.push(R);for(var N=0;N<_;N++){A=N-w,F=H-D;n.getVisible(A,F)?(I=n.getTargetMap(A,F)).getBody(N,H)||"2"===I.id&&T[H][N]?R.push(1):R.push(0):R.push(1)}}l.setGrid(M),l.enableDiagonals(),l.enableSync();for(H=0;H<g;H++)for(N=0;N<_;N++)if(A=N-w,F=H-D,n.getVisible(A,F)){var I,L=(I=n.getTargetMap(A,F)).getWalls(N,H);if(0!==L){var P=[];0==(L&c.CardinalDirectionFlags.NORTH)&&P.push(d.TOP),0==(L&c.CardinalDirectionFlags.EAST)&&P.push(d.RIGHT),0==(L&c.CardinalDirectionFlags.SOUTH)&&P.push(d.BOTTOM),0==(L&c.CardinalDirectionFlags.WEST)&&P.push(d.LEFT),l.setDirectionalCondition(N,H,P)}}return e=!0,l.findPath(w,D,v,y,(function(i){t=i,e=!1,requestAnimationFrame(r)})),void l.calculate()}}setTimeout((function(){return requestAnimationFrame(r)}),120)}}))}}},e={};!function i(r){if(e[r])return e[r].exports;var n=e[r]={exports:{}};return t[r].call(n.exports,n,n.exports,i),n.exports}(725)})();
//# sourceMappingURL=demo.js.map