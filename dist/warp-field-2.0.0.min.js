var WarpField;WarpField=(()=>{"use strict";var t={677:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.axisAddCardinalTurn=e.axisFromNorthSouthTurn=e.axisFromCardinalDirection=e.axisOrthogonal=e.axisToString=e.AXES=e.Axis=void 0,function(t){t[t.NORTH_SOUTH=0]="NORTH_SOUTH",t[t.WEST_EAST=1]="WEST_EAST"}(i=e.Axis||(e.Axis={})),e.AXES=[i.NORTH_SOUTH,i.WEST_EAST];const r=["N-S","W-E"];e.axisToString=function(t){return r[t]},e.axisOrthogonal=function(t){return 1^t},e.axisFromCardinalDirection=function(t){return 1&t},e.axisFromNorthSouthTurn=function(t){return 1&t},e.axisAddCardinalTurn=function(t,e){return t+e&1}},340:(t,e)=>{var i;function r(t){return 1<<t}Object.defineProperty(e,"__esModule",{value:!0}),e.cardinalDirectionFlagsFromCardinalDirection=e.cardinalDirectionFlagsRemoveCardinalDirection=e.cardinalDirectionFlagsSetCardinalDirection=e.cardinalDirectionFlagsHasCardinalDirection=e.cardinalDirectionFlagsToString=e.CardinalDirectionFlags=void 0,function(t){t[t.NONE=0]="NONE",t[t.NORTH=1]="NORTH",t[t.EAST=2]="EAST",t[t.SOUTH=4]="SOUTH",t[t.WEST=8]="WEST",t[t.ALL=15]="ALL"}(i=e.CardinalDirectionFlags||(e.CardinalDirectionFlags={})),e.cardinalDirectionFlagsToString=function(t){let e="[";return 0!=(t&i.NORTH)&&(e+="N"),0!=(t&i.EAST)&&(e+="E"),0!=(t&i.SOUTH)&&(e+="S"),0!=(t&i.WEST)&&(e+="W"),e+"]"},e.cardinalDirectionFlagsHasCardinalDirection=function(t,e){return 0!=(t&r(e))},e.cardinalDirectionFlagsSetCardinalDirection=function(t,e){return t|r(e)},e.cardinalDirectionFlagsRemoveCardinalDirection=function(t,e){return t&~r(e)},e.cardinalDirectionFlagsFromCardinalDirection=r},343:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.cardinalDirectionAddCardinalTurn=e.cardinalDirectionFromCardinalOrientation=e.cardinalDirectionFromNorthTurn=e.cardinalDirectionFromDirection=e.cardinalDirectionOpposite=e.cardinalDirectionToString=e.CARDINAL_DIRECTIONS=e.CardinalDirection=void 0,function(t){t[t.NORTH=0]="NORTH",t[t.EAST=1]="EAST",t[t.SOUTH=2]="SOUTH",t[t.WEST=3]="WEST"}(i=e.CardinalDirection||(e.CardinalDirection={})),e.CARDINAL_DIRECTIONS=[i.NORTH,i.EAST,i.SOUTH,i.WEST];const r=["N","E","S","W"];e.cardinalDirectionToString=function(t){return r[t]},e.cardinalDirectionOpposite=function(t){return t+2&3},e.cardinalDirectionFromDirection=function(t){return t>>1},e.cardinalDirectionFromNorthTurn=function(t){return t},e.cardinalDirectionFromCardinalOrientation=function(t){return t>>>1},e.cardinalDirectionAddCardinalTurn=function(t,e){return t+e&3}},852:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.cardinalOrientationAddCardinalTurn=e.cardinalOrientationFromFlipAndCardinalDirection=e.cardinalOrientationReverse=e.cardinalOrientationFlip=e.cardinalOrientationToString=e.CARDINAL_ORIENTATIONS=e.CardinalOrientation=void 0;const r=i(677),n=i(254);var s;!function(t){t[t.HEADS_NORTH=0]="HEADS_NORTH",t[t.TAILS_NORTH=1]="TAILS_NORTH",t[t.HEADS_EAST=2]="HEADS_EAST",t[t.TAILS_EAST=3]="TAILS_EAST",t[t.HEADS_SOUTH=4]="HEADS_SOUTH",t[t.TAILS_SOUTH=5]="TAILS_SOUTH",t[t.HEADS_WEST=6]="HEADS_WEST",t[t.TAILS_WEST=7]="TAILS_WEST"}(s=e.CardinalOrientation||(e.CardinalOrientation={})),e.CARDINAL_ORIENTATIONS=[s.HEADS_NORTH,s.TAILS_NORTH,s.HEADS_EAST,s.TAILS_EAST,s.HEADS_SOUTH,s.TAILS_SOUTH,s.HEADS_WEST,s.TAILS_WEST];const a=["HN","TN","HE","TE","HS","TS","HW","TW"];e.cardinalOrientationToString=function(t){return a[t]},e.cardinalOrientationFlip=function(t,e){return e===r.Axis.NORTH_SOUTH?9-t&7:13-t&7},e.cardinalOrientationReverse=function(t){return t===s.HEADS_EAST?s.HEADS_WEST:t===s.HEADS_WEST?s.HEADS_EAST:t},e.cardinalOrientationFromFlipAndCardinalDirection=function(t,e){return 2*e+(t!==n.Flip.HEADS?1:0)},e.cardinalOrientationAddCardinalTurn=function(t,e){return t+2*e&7}},974:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.cardinalTurnAddCardinalTurn=e.cardinalTurnFromTurn=e.cardinalTurnFromCardinalDirections=e.cardinalTurnReverse=e.cardinalTurnToDegrees=e.cardinalTurnToString=e.CARDINAL_TURNS=e.CardinalTurn=void 0,function(t){t[t.NONE=0]="NONE",t[t.RIGHT=1]="RIGHT",t[t.AROUND=2]="AROUND",t[t.LEFT=3]="LEFT"}(i=e.CardinalTurn||(e.CardinalTurn={})),e.CARDINAL_TURNS=[i.NONE,i.RIGHT,i.AROUND,i.LEFT];const r=["T0","T+90","T180","T-90"];e.cardinalTurnToString=function(t){return r[t]},e.cardinalTurnToDegrees=function(t){return 90*t},e.cardinalTurnReverse=function(t){return 4-t&3},e.cardinalTurnFromCardinalDirections=function(t,e){return e-t&3},e.cardinalTurnFromTurn=function(t){return t>>1},e.cardinalTurnAddCardinalTurn=function(t,e){return t+e&3}},588:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.directionAddCardinalTurn=e.directionAddTurn=e.directionFromCardinalDirection=e.directionOpposite=e.directionIsCardinal=e.directionToString=e.DIRECTIONS=e.Direction=void 0,function(t){t[t.NORTH=0]="NORTH",t[t.NORTHEAST=1]="NORTHEAST",t[t.EAST=2]="EAST",t[t.SOUTHEAST=3]="SOUTHEAST",t[t.SOUTH=4]="SOUTH",t[t.SOUTHWEST=5]="SOUTHWEST",t[t.WEST=6]="WEST",t[t.NORTHWEST=7]="NORTHWEST"}(i=e.Direction||(e.Direction={})),e.DIRECTIONS=[i.NORTH,i.NORTHEAST,i.EAST,i.SOUTHEAST,i.SOUTH,i.SOUTHWEST,i.WEST,i.NORTHWEST];const r=["N","NE","E","SE","S","SW","W","NW"];e.directionToString=function(t){return r[t]},e.directionIsCardinal=function(t){return 0==(1&t)},e.directionOpposite=function(t){return t+4&7},e.directionFromCardinalDirection=function(t){return t<<1},e.directionAddTurn=function(t,e){return t+e&7},e.directionAddCardinalTurn=function(t,e){return t+2*e&7}},254:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.flipFromCardinalOrientation=e.flipFromBoolean=e.flipOpposite=e.flipToString=e.FLIPS=e.Flip=void 0,function(t){t[t.HEADS=0]="HEADS",t[t.TAILS=1]="TAILS"}(i=e.Flip||(e.Flip={})),e.FLIPS=[i.HEADS,i.TAILS];const r=["H","T"];e.flipToString=function(t){return r[t]},e.flipOpposite=function(t){return 1^t},e.flipFromBoolean=function(t){return t?i.TAILS:i.HEADS},e.flipFromCardinalOrientation=function(t){return 1&t}},778:function(t,e,i){var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),n=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),n(i(588),e),n(i(854),e),n(i(343),e),n(i(974),e),n(i(340),e),n(i(254),e),n(i(852),e),n(i(677),e)},854:(t,e)=>{var i;Object.defineProperty(e,"__esModule",{value:!0}),e.turnAddTurn=e.turnFromDirections=e.turnFromCardinalTurn=e.turnFromCardinalDirections=e.turnReverse=e.turnIsCardinal=e.turnToDegrees=e.turnToString=e.TURNS=e.Turn=void 0,function(t){t[t.NONE=0]="NONE",t[t.R_45=1]="R_45",t[t.R_90=2]="R_90",t[t.R_135=3]="R_135",t[t.T_180=4]="T_180",t[t.L_135=5]="L_135",t[t.L_90=6]="L_90",t[t.L_45=7]="L_45"}(i=e.Turn||(e.Turn={})),e.TURNS=[i.NONE,i.R_45,i.R_90,i.R_135,i.T_180,i.L_135,i.L_90,i.L_45];const r=["T0","T+45","T+90","T+135","T180","T-135","T-90","T-45"];e.turnToString=function(t){return r[t]},e.turnToDegrees=function(t){return 45*t},e.turnIsCardinal=function(t){return 0==(1&t)},e.turnReverse=function(t){return 8-t&7},e.turnFromCardinalDirections=function(t,e){return 2*(e-t)&7},e.turnFromCardinalTurn=function(t){return t<<1},e.turnFromDirections=function(t,e){return e-t&7},e.turnAddTurn=function(t,e){return t+e&7}},913:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CardinalPath=void 0;const r=i(778),n=i(894),s=i(84),a=i(37),o=new n.Offset;function h(t,e){t.push(e);let i=t.length-1;for(;i>0&&e<t[i-1];)t[i]=t[i-1],i--;t[i]=e}e.CardinalPath=class{constructor(t,e){this._start=new n.Offset,this._start.copyFrom(t),this._segments=e}toString(){return`${this._start.toString()}:${this._segments.map((t=>r.cardinalDirectionToString(t))).join("")}`}equals(t){return this._start.equals(t._start)&&this._segments.length===t._segments.length&&this._segments.every(((e,i)=>e===t._segments[i]))}get length(){return this._segments.length}getIsClosed(){o.copyFrom(this._start);for(const t of this._segments)o.addCardinalDirection(t);return this._start.equals(o)}*offsets(){let{x:t,y:e}=this._start;yield{x:t,y:e};for(const i of this._segments)o.setFromCardinalDirection(i),t+=o.x,e+=o.y,yield{x:t,y:e}}getBounds(){let t=this._start.y,e=t,i=this._start.x,n=i;o.copyFrom(this._start);for(const s of this._segments)switch(o.addCardinalDirection(s),s){case r.CardinalDirection.NORTH:t=Math.min(t,o.y);break;case r.CardinalDirection.EAST:n=Math.max(n,o.x);break;case r.CardinalDirection.SOUTH:e=Math.max(e,o.y);break;case r.CardinalDirection.WEST:i=Math.min(i,o.x);break;default:throw new Error(`bad direction ${s} in cardinal path`)}return new s.Rectangle(i,t,n-i+1,e-t+1)}getArea(){let t=0;o.copyFrom(this._start);for(const e of this._segments)switch(o.addCardinalDirection(e),e){case r.CardinalDirection.NORTH:t-=o.x;break;case r.CardinalDirection.SOUTH:t+=o.x}return Math.abs(t)}rasterize(t){const e=new Array;void 0===t&&(t=this.getBounds()),o.copyFrom(this._start);const{northY:i}=t,n=i+t.height-1;for(let t=i;t<n;t++)e.push([]);o.copyFrom(this._start);for(const t of this._segments)t===r.CardinalDirection.SOUTH&&h(e[o.y-i],o.x),o.addCardinalDirection(t),t===r.CardinalDirection.NORTH&&h(e[o.y-i],o.x);return new a.RasterMask({westX:t.westX,northY:t.northY,width:t.width-1,height:t.height-1},e)}}},551:function(t,e,i){var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),n=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),n(i(894),e),n(i(925),e),n(i(84),e),n(i(475),e),n(i(12),e),n(i(37),e),n(i(913),e),n(i(917),e)},12:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.MaskRectangle=void 0;const r=i(84),n=i(475);e.MaskRectangle=class{constructor(t,e=!1,i=!1){this._rect=new r.Rectangle,void 0!==t&&this._rect.copyFrom(t),this._mask=new n.Mask(t,e),this._outsideValue=i}toString(){return`${this._rect.northWest}/${this._outsideValue}\n${this._mask}`}equals(t){return this._rect.equals(t._rect)&&this._mask.equals(t._mask)&&this._outsideValue===t._outsideValue}get westX(){return this._rect.westX}get northY(){return this._rect.northY}get width(){return this._rect.width}get height(){return this._rect.height}get(t,e){return this._rect.contains(t,e)?this._mask.get(t-this.westX,e-this.northY):this._outsideValue}getAtIndex(t){return this._mask.getAtIndex(t)}getAtOffset(t){return this.get(t.x,t.y)}copyFrom(t){return this._rect.copyFrom(t._rect),this._mask.copyFrom(t._mask),this._outsideValue=t._outsideValue,this}set(t,e,i){return this._mask.set(t-this.westX,e-this.northY,i),this}setAtOffset(t,e){return this.set(t.x,t.y,e)}setAtIndex(t,e){return this._mask.setAtIndex(t,e),this}index(t,e){return this._mask.index(t-this.westX,e-this.northY)}*locations(){for(const t of this._mask.locations()){const e=t.x+this.westX,i=t.y+this.northY,{value:r}=t;yield{x:e,y:i,value:r}}}*offsetsWithTrue(){for(const t of this._mask.offsetsWithTrue()){const e=t.x+this.westX,i=t.y+this.northY;yield{x:e,y:i}}}}},475:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Mask=void 0;const r=i(925);e.Mask=class{constructor(t,e=!1){this._size=new r.Size,void 0!==t&&this._size.copyFrom(t),this._bits=new Array(Math.ceil(this._size.area/32)).fill(e?4294967295:0)}toString(){let t="";for(let e=0;e<this.height;e++){for(let i=0;i<this.width;i++)t+=this.get(i,e)?"☑":"☐";t+="\n"}return t}equals(t){return this._size.equals(t._size)&&this._bits.length===t._bits.length&&this._bits.every(((e,i)=>e===t._bits[i]))}get width(){return this._size.width}get height(){return this._size.height}get(t,e){return this.getAtIndex(this.index(t,e))}getAtOffset(t){return this.get(t.x,t.y)}getAtIndex(t){const e=t>>>5,i=1<<(31&t);return 0!=(this._bits[e]&i)}copyFrom(t){return this._size.copyFrom(t._size),this._bits=t._bits.slice(),this}set(t,e,i){return this.setAtIndex(this.index(t,e),i)}setAtOffset(t,e){return this.set(t.x,t.y,e)}setAtIndex(t,e){const i=t>>>5,r=1<<(31&t);return e?this._bits[i]|=r:this._bits[i]&=~r,this}index(t,e){return this._size.index(t,e)}*locations(){let t=0,e=1;for(const{x:i,y:r}of this._size.offsets()){const n=0!=(this._bits[t]&e);yield{x:i,y:r,value:n},e===1<<31?(e=1,t++):e<<=1}}*offsetsWithTrue(){for(const{x:t,y:e,value:i}of this.locations())i&&(yield{x:t,y:e})}}},894:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Offset=void 0;const r=i(778),n=[0,1,1,1,0,-1,-1,-1],s=[-1,-1,0,1,1,1,0,-1],a=[0,1,0,-1],o=[-1,0,1,0];e.Offset=class{constructor(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}toString(){return`(${this.x},${this.y})`}equals(t){return this.x===t.x&&this.y===t.y}set(t,e){return this.x=t,this.y=e,this}copyFrom(t){return this.set(t.x,t.y)}setFromDirection(t){return this.set(n[t],s[t])}setFromCardinalDirection(t){return this.set(a[t],o[t])}add(t,e){return this.x+=t,this.y+=e,this}addSize(t){return this.add(t.width,t.height)}addOffset(t){return this.add(t.x,t.y)}addDirection(t){return this.add(n[t],s[t])}addCardinalDirection(t){return this.add(a[t],o[t])}subtractOffset(t){return this.add(-t.x,-t.y)}multiply(t){return this.x*=t,this.y*=t,this}rotate(t,e){if(e)return this.subtractOffset(e).rotate(t).addOffset(e);{const e=r.cardinalDirectionFromNorthTurn(t),{x:i,y:n}=this,s=a[e],h=o[e],l=-n*s-i*h,d=i*s-n*h;return this.set(l,d)}}distanceChebyshev(t){return Math.max(Math.abs(this.x-t.x),Math.abs(this.y-t.y))}distanceManhattan(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}*nearbyChebyshevOffsets(t,e){if(e>=0)for(let i=-e;i<=e;i++)for(let r=-e;r<=e;r++)yield t.set(this.x+r,this.y+i)}}},37:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.RasterMask=void 0;const r=i(84);e.RasterMask=class{constructor(t,e){if(this._rect=new r.Rectangle,e.length!==t.height)throw new Error(`bad lines array length ${e.length} for bounds ${t}`);this._rect.copyFrom(t),this._lines=e}toString(){let t="";const{eastX:e}=this._rect;for(let i=0;i<this.height;i++){const r=this._lines[i];let n=this.westX;for(let e=0;e<r.length;e+=2){const i=r[e],s=r[e+1];for(;n<i;)t+="∙",n++;for(;n<s;)t+="█",n++}for(;n<=e;)t+="∙",n++;t+="\n"}return`(${this._rect.westX},${this._rect.northY})\n${t}`}equals(t){return this._rect.equals(t._rect)&&this._lines.length===t._lines.length&&this._lines.every(((e,i)=>e.length===t._lines[i].length&&e.every(((e,r)=>e===t._lines[i][r]))))}get northY(){return this._rect.northY}get southY(){return this._rect.southY}get westX(){return this._rect.westX}get width(){return this._rect.width}get height(){return this._rect.height}get(t,e){if(e<this.northY||e>this._rect.southY)return!1;const i=this._lines[e-this.northY];for(let e=0;e<i.length;e+=2)if(t>=i[e]&&t<i[e+1])return!0;return!1}getAtOffset(t){return this.get(t.x,t.y)}*bandsAt(t){if(t>=this.northY&&t<=this._rect.southY){const e=this._lines[t-this.northY];for(let t=0;t<e.length;t+=2)yield{westX:e[t],eastX:e[t+1]-1}}}}},84:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Rectangle=void 0;const r=i(925),n=i(894),s=[0,0,1,1],a=[0,1,1,0];e.Rectangle=class{constructor(t,e,i,s){void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),this.northWest=new n.Offset(t,e),this.size=new r.Size(i,s)}toString(){return`(${this.westX},${this.northY} ${this.width}x${this.height})`}equals(t){return this.westX===t.westX&&this.northY===t.northY&&this.size.equals(t)}get northY(){return this.northWest.y}get southY(){return this.northWest.y+this.size.height-1}get westX(){return this.northWest.x}get eastX(){return this.northWest.x+this.size.width-1}get width(){return this.size.width}get height(){return this.size.height}get empty(){return this.size.empty}get area(){return this.size.area}set(t,e,i,r){return this.northWest.set(t,e),this.size.set(i,r),this}setFromCorners(t,e){const i=Math.min(t.x,e.x),r=Math.max(t.x,e.x),n=Math.min(t.y,e.y),s=Math.max(t.y,e.y);return this.set(i,n,r-i+1,s-n+1)}copyFrom(t){return this.set(t.westX,t.northY,t.width,t.height)}addOffset(t){return this.northWest.addOffset(t),this}scale(t){return this.northWest.multiply(t),this.size.multiply(t),this}rotate(t,e){const i=s[t],r=a[t];return this.northWest.add(i*(this.width-1),r*(this.height-1)).rotate(t,e),this.size.rotate(t),this}extendToInclude(t){const e=t.x-this.westX;e<0?(this.size.width-=e,this.northWest.x=t.x):e>=this.size.width&&(this.size.width=e+1);const i=t.y-this.northWest.y;return i<0?(this.size.height-=i,this.northWest.y=t.y):i>=this.size.height&&(this.size.height=i+1),this}contains(t,e){return this.size.contains(t-this.westX,e-this.northY)}index(t,e){return this.size.index(t-this.westX,e-this.northY)}containsOffset(t){return this.contains(t.x,t.y)}containsRectangle(t){if(0===t.width&&0===t.height)return!1;const e=t.westX-this.westX,i=t.northY-this.northY;return!!this.size.contains(e,i)&&this.size.contains(e+t.width-1,i+t.height-1)}overlapsRectangle(t){return this.northY<=t.northY+t.height-1&&this.southY>=t.northY&&this.westX<=t.westX+t.width-1&&this.eastX>=t.westX&&!this.empty&&0!==t.width&&0!==t.height}*offsets(){const{eastX:t,southY:e}=this;for(let i=this.northY;i<=e;i++)for(let e=this.westX;e<=t;e++)yield{x:e,y:i}}anyOf(t){for(const{x:e,y:i}of this.offsets())if(t(e,i))return!0;return!1}}},925:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Size=void 0;const r=i(778);e.Size=class{constructor(t,e){if(void 0===t&&(t=0),void 0===e&&(e=0),t<0||e<0)throw new Error(`bad size (${t}x${e})`);this.width=t,this.height=e}toString(){return`(${this.width}x${this.height})`}equals(t){return this.width===t.width&&this.height===t.height}get empty(){return 0===this.width||0===this.height}get area(){return this.width*this.height}set(t,e){if(t<0||e<0)throw new Error(`bad size (${t}x${e})`);return this.width=t,this.height=e,this}copyFrom(t){return this.set(t.width,t.height)}add(t,e){return this.width+=t,this.height+=e,this}multiply(t){return this.width*=t,this.height*=t,this}rotate(t){return r.axisFromNorthSouthTurn(t)===r.Axis.WEST_EAST&&this.set(this.height,this.width),this}contains(t,e){return t>=0&&e>=0&&t<this.width&&e<this.height}containsOffset(t){return this.contains(t.x,t.y)}index(t,e){return e*this.width+t}*offsets(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)yield{x:e,y:t}}anyOf(t){for(const{x:e,y:i}of this.offsets())if(t(e,i))return!0;return!1}}},917:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TransformRectangle=void 0;const r=i(84),n=i(778),s=i(894),a=i(925),o=new s.Offset,h=new s.Offset,l=new a.Size;e.TransformRectangle=class{constructor(t,e){this._size=new a.Size,this._flip=n.Flip.HEADS,this._rotate=n.CardinalTurn.NONE,this._translate=new s.Offset,this._matrix=[1,0,0,0,1,0],this._targetRect=new r.Rectangle,void 0===t||("number"==typeof t?this._size.set(t,e):this._size.copyFrom(t)),this._update()}toString(){return`[${this._size} -> ${n.flipToString(this._flip)} ${n.cardinalTurnToString(this._rotate)} ${this._translate} -> ${this._targetRect}]`}equals(t){return this._size.equals(t._size)&&this._flip===t._flip&&this._rotate===t._rotate&&this._translate.equals(t._translate)}get flip(){return this._flip}get rotate(){return this._rotate}get northY(){return this._translate.y}get southY(){return this._translate.y+this._targetRect.height-1}get westX(){return this._translate.x}get eastX(){return this._translate.x+this._targetRect.width-1}get width(){return this._targetRect.width}get height(){return this._targetRect.height}_update(){o.setFromCardinalDirection(n.cardinalDirectionFromNorthTurn(this._rotate));const t=this._flip===n.Flip.TAILS?-1:1;switch(this._matrix[0]=-o.y*t,this._matrix[1]=-o.x,this._matrix[2]=this._translate.x,this._matrix[3]=o.x*t,this._matrix[4]=-o.y,this._matrix[5]=this._translate.y,this._rotate){case n.CardinalTurn.NONE:this._flip===n.Flip.TAILS&&(this._matrix[2]+=this._size.width-1);break;case n.CardinalTurn.RIGHT:this._matrix[2]+=this._size.height-1,this._flip===n.Flip.TAILS&&(this._matrix[5]+=this._size.width-1);break;case n.CardinalTurn.AROUND:this._matrix[5]+=this._size.height-1,this._flip===n.Flip.HEADS&&(this._matrix[2]+=this._size.width-1);break;case n.CardinalTurn.LEFT:this._flip===n.Flip.HEADS&&(this._matrix[5]+=this._size.width-1)}return l.copyFrom(this._size).rotate(this._rotate),this._targetRect.set(this._translate.x,this._translate.y,l.width,l.height),this}copyFrom(t){return this._size.copyFrom(t._size),this._flip=t._flip,this._rotate=t._rotate,this._translate.copyFrom(t._translate),t._matrix.forEach(((t,e)=>this._matrix[e]=t)),this._targetRect.copyFrom(t._targetRect),this}reset(){return this._flip=n.Flip.HEADS,this._rotate=n.CardinalTurn.NONE,this._translate.set(0,0),this._update()}invert(){const t=n.cardinalTurnFromCardinalDirections(n.CardinalDirection.NORTH,n.cardinalDirectionFromCardinalOrientation(n.cardinalOrientationReverse(n.cardinalOrientationFromFlipAndCardinalDirection(this._flip,n.cardinalDirectionFromNorthTurn(this._rotate)))));return this._rotate=t,this._size.rotate(t),this._translate.multiply(-1),this._update()}setTransform(t,e,i){return this._flip=t,this._rotate=e,this._translate.copyFrom(i),this._update()}setFlip(t){return this._flip=t,this._update()}setRotate(t){return this._rotate=t,this._update()}setTranslate(t,e){return this._translate.set(t,e),this._update()}setTranslateOffset(t){return this._translate.copyFrom(t),this._update()}applyToCardinalOrientation(t){return this._flip===n.Flip.TAILS&&(t=n.cardinalOrientationFlip(t,n.Axis.NORTH_SOUTH)),n.cardinalOrientationAddCardinalTurn(t,this._rotate)}unapplyFromCardinalOrientation(t){return t=n.cardinalOrientationAddCardinalTurn(t,n.cardinalTurnReverse(this._rotate)),this._flip===n.Flip.TAILS&&(t=n.cardinalOrientationFlip(t,n.Axis.NORTH_SOUTH)),t}applyToCardinalDirection(t){return n.cardinalDirectionFromCardinalOrientation(this.applyToCardinalOrientation(n.cardinalOrientationFromFlipAndCardinalDirection(n.Flip.HEADS,t)))}unapplyFromCardinalDirection(t){return n.cardinalDirectionFromCardinalOrientation(this.unapplyFromCardinalOrientation(n.cardinalOrientationFromFlipAndCardinalDirection(n.Flip.HEADS,t)))}applyTo(t,e,i){const r=e*this._matrix[0]+i*this._matrix[1]+this._matrix[2],n=e*this._matrix[3]+i*this._matrix[4]+this._matrix[5];return t.set(r,n)}unapplyFrom(t,e,i){const r=e-this._matrix[2],n=i-this._matrix[5],s=r*this._matrix[0]+n*this._matrix[3],a=r*this._matrix[1]+n*this._matrix[4];return t.set(s,a)}applyToOffset(t,e){return void 0===e&&(e=t),this.applyTo(t,e.x,e.y)}unapplyFromOffset(t,e){return void 0===e&&(e=t),this.unapplyFrom(t,e.x,e.y)}applyToRectangle(t,e){return void 0!==e&&t.copyFrom(e),o.set(t.westX,t.northY),h.set(t.eastX,t.southY),this.applyToOffset(o),this.applyToOffset(h),t.setFromCorners(o,h)}unapplyFromRectangle(t,e){return void 0!==e&&t.copyFrom(e),o.set(t.westX,t.northY),h.set(t.eastX,t.southY),this.unapplyFromOffset(o),this.unapplyFromOffset(h),t.setFromCorners(o,h)}}},841:function(t,e,i){var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),n=this&&this.__exportStar||function(t,e){for(var i in t)"default"===i||Object.prototype.hasOwnProperty.call(e,i)||r(e,t,i)};Object.defineProperty(e,"__esModule",{value:!0}),n(i(778),e),n(i(551),e)},695:function(t,e,i){var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return n(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.computeFieldOfView=void 0;const a=s(i(841)),o=s(i(601)),h=i(720),l=i(702),d=i(550),c=i(101);function u(t,e,i,r,n,s,d){const c=[a.CardinalDirection.NORTH,a.CardinalDirection.SOUTH][(n+1)/2],u=[a.CardinalDirection.WEST,a.CardinalDirection.EAST][(r+1)/2],_=[l.TileFlags.WALL_NORTH,l.TileFlags.WALL_SOUTH][(n+1)/2],f=[l.TileFlags.WALL_WEST,l.TileFlags.WALL_EAST][(r+1)/2];let p=h.initWedges(d);for(let e=0;e<=i;e++){const a=e*n;for(let n=0;n<=i;n++){const i=n*r,d=(n-.5)/(e+.5),g=(n+.5)/(e+.5),T=0!==e?n/e:Number.POSITIVE_INFINITY,O=0!==e?(n+.5)/(e-.5):Number.POSITIVE_INFINITY;{const e=h.getBestWedge(p,d,T,O);t.warps[t.visible.index(i,a)]=e.warp,e.shadow&&t.visible.set(i,a,!1)}const S=[];for(const t of p){if(t.low>=O||t.high<=d){S.push(t);continue}const r=t.warp,p=r.map,T=r.shiftX+i,m=r.shiftY+a;if(!p.contains(T,m)){S.push(t);continue}const w=p.index(T,m),y=p.getTileFlagsAtIndex(w),A=p.getWarpAtIndex(w,c),F=p.getWarpAtIndex(w,u),D=!A&&0!=(y&_),E=!F&&0!=(y&f);let v;v=D&&E?h.addShadow(t,d-o.WALL_OUTSET,O+o.WALL_OUTSET):0===n&&0===e||0==(y&l.TileFlags.BODY)?D?h.addShadow(t,d-o.WALL_OUTSET,g+o.WALL_OUTSET):E?h.addShadow(t,g-o.WALL_OUTSET,O+o.WALL_OUTSET):[t]:D?h.addShadow(t,d-o.WALL_OUTSET,O-o.BODY_INSET):E?h.addShadow(t,d+o.BODY_INSET,O+o.WALL_OUTSET):h.addShadow(t,d+o.BODY_INSET,O-o.BODY_INSET);for(const t of v)if(A&&F){const e=s.get(A.map,r.warpCount+1,r.shiftX+A.offsetShift.x,r.shiftY+A.offsetShift.y),i=h.addWarp(t,e,d-o.WARP_OUTSET,g),n=s.get(F.map,r.warpCount+1,r.shiftX+F.offsetShift.x,r.shiftY+F.offsetShift.y);for(const t of i)S.push(...h.addWarp(t,n,g,O+o.WARP_OUTSET))}else if(A){const e=s.get(A.map,r.warpCount+1,r.shiftX+A.offsetShift.x,r.shiftY+A.offsetShift.y);S.push(...h.addWarp(t,e,d-o.WARP_OUTSET,g+o.WARP_OUTSET))}else if(F){const e=s.get(F.map,r.warpCount+1,r.shiftX+F.offsetShift.x,r.shiftY+F.offsetShift.y);S.push(...h.addWarp(t,e,g-o.WARP_OUTSET,O+o.WARP_OUTSET))}else S.push(t)}p=h.mergeWedges(S)}}}e.computeFieldOfView=function(t,e,i,r){if(!t.contains(e,i))throw new Error("origin is not on the map");const n=new a.Offset(e,i),s=new d.FieldOfViewImpl(t,n,r),o=new c.WarpDataCache,h=o.get(t,0,e,i);return u(s,0,r,-1,-1,o,h),u(s,0,r,1,-1,o,h),u(s,0,r,-1,1,o,h),u(s,0,r,1,1,o,h),s}},601:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.PICK_WEDGE_EPSILON=e.WARP_OUTSET=e.WALL_OUTSET=e.BODY_INSET=void 0,e.BODY_INSET=1e-5,e.WALL_OUTSET=e.BODY_INSET/4,e.WARP_OUTSET=e.WALL_OUTSET/4,e.PICK_WEDGE_EPSILON=2*e.WALL_OUTSET},550:function(t,e,i){var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return n(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.FieldOfViewImpl=void 0;const a=s(i(841));e.FieldOfViewImpl=class{constructor(t,e,i){this.map=t,this.origin=e,this.chebyshevRadius=i;const r=new a.Rectangle(-i,-i,2*i+1,2*i+1);this.visible=new a.MaskRectangle(r,!0),this.visible.set(0,0,!0),this.warps=new Array(r.area)}getVisible(t,e){return this.visible.get(t,e)}getTargetMap(t,e){return this._getWarp(t,e).map}getTargetOffset(t,e){const i=this._getWarp(t,e);return{x:i.shiftX+t,y:i.shiftY+e}}toString(){let t="";for(let e=-this.chebyshevRadius;e<=this.chebyshevRadius;e++){for(let i=-this.chebyshevRadius;i<=this.chebyshevRadius;i++)0===i&&0===e?t+="@":this.getVisible(i,e)?t+=this._getWarp(i,e).map.id[0]:t+=".";t+="\n"}return t}_getWarp(t,e){return this.warps[this.visible.index(t,e)]}}},60:function(t,e,i){var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return n(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.FieldOfViewMap=void 0;const a=s(i(841)),o=i(702),h=new a.Offset;e.FieldOfViewMap=class{constructor(t,e,i,r=!1){if(this._size=new a.Size,this._warps=new Array,this.id=t,this._size.set(e,i),this._tileFlags=new Array(this._size.area).fill(0),r){for(let t=0;t<this._size.height;t++)this._addFlag(0,t,o.TileFlags.WALL_WEST),this._addFlag(this._size.width-1,t,o.TileFlags.WALL_EAST);for(let t=0;t<this._size.width;t++)this._addFlag(t,0,o.TileFlags.WALL_NORTH),this._addFlag(t,this._size.height-1,o.TileFlags.WALL_SOUTH)}this._tileWarpIds=a.CARDINAL_DIRECTIONS.map((()=>new Array(this._size.area).fill(-1)))}get width(){return this._size.width}get height(){return this._size.height}addBody(t,e){return this._addFlag(t,e,o.TileFlags.BODY),this}removeBody(t,e){return this._removeFlag(t,e,o.TileFlags.BODY),this}getBody(t,e){const i=this.index(t,e);return 0!=(this._tileFlags[i]&o.TileFlags.BODY)}addWall(t,e,i,r=!1){return this._addFlag(t,e,1<<i),h.set(t,e),h.addCardinalDirection(i),!r&&this._size.containsOffset(h)&&this._addFlag(h.x,h.y,1<<a.cardinalDirectionOpposite(i)),this}removeWall(t,e,i,r=!1){return this._removeFlag(t,e,1<<i),h.set(t,e),h.addCardinalDirection(i),!r&&this._size.containsOffset(h)&&this._removeFlag(h.x,h.y,1<<a.cardinalDirectionOpposite(i)),this}getWalls(t,e){const i=this.index(t,e);return this._tileFlags[i]&a.CardinalDirectionFlags.ALL}getWall(t,e,i){return 0!=(this.getWalls(t,e)&1<<i)}addWarp(t,e,i,r,n,s,o){if(!o){h.set(t-n,e-s).addCardinalDirection(i);const o=r._findOrMakeWarp(this,h);r._addWarp(n,s,a.cardinalDirectionOpposite(i),o)}h.set(n-t,s-e).addCardinalDirection(a.cardinalDirectionOpposite(i));const l=this._findOrMakeWarp(r,h);return this._addWarp(t,e,i,l),this}removeWarp(t,e,i,r=!1){if(!r){const r=this._getWarp(t,e,i);if(!r)return this;h.set(t,e).addCardinalDirection(i).addOffset(r.offsetShift),r.map._removeWarp(h.x,h.y,a.cardinalDirectionOpposite(i))}return this._removeWarp(t,e,i),this}getWarpFlags(t,e){let i=a.CardinalDirectionFlags.NONE;return a.CARDINAL_DIRECTIONS.forEach((r=>{this._getWarp(t,e,r)&&(i=a.cardinalDirectionFlagsSetCardinalDirection(i,r))})),i}getWarpFlag(t,e,i){return!!this._getWarp(t,e,i)}getWarpTargetMap(t,e,i){var r;return null===(r=this._getWarp(t,e,i))||void 0===r?void 0:r.map}getWarpTargetOffset(t,e,i){var r;const n=null===(r=this._getWarp(t,e,i))||void 0===r?void 0:r.offsetShift;if(n)return h.copyFrom(n).add(t,e).addCardinalDirection(i),{x:h.x,y:h.y}}index(t,e){return this._size.index(t,e)}_addFlag(t,e,i){const r=this.index(t,e);this._tileFlags[r]|=i}_removeFlag(t,e,i){const r=this.index(t,e);this._tileFlags[r]&=~i}_makeWarp(t,e,i){const r=this._warps.length;return this._warps.push({map:t,offsetShift:new a.Offset(e,i)}),r}_findOrMakeWarp(t,e){for(let i=0;i<this._warps.length;i++){const r=this._warps[i];if(r.map===t&&r.offsetShift.equals(e))return i}return this._makeWarp(t,e.x,e.y)}_addWarp(t,e,i,r){const n=this.index(t,e);this._tileWarpIds[i][n]=r}_removeWarp(t,e,i){const r=this.index(t,e);delete this._tileWarpIds[i][r]}_getWarp(t,e,i){const r=this.index(t,e);return this.getWarpAtIndex(r,i)}contains(t,e){return this._size.contains(t,e)}getTileFlagsAtIndex(t){return this._tileFlags[t]}getWarpAtIndex(t,e){const i=this._tileWarpIds[e][t];return-1===i?void 0:this._warps[i]}}},607:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Offset=e.CardinalDirectionFlags=e.CardinalDirection=e.computeFieldOfView=e.FieldOfViewMap=void 0;var r=i(60);Object.defineProperty(e,"FieldOfViewMap",{enumerable:!0,get:function(){return r.FieldOfViewMap}});var n=i(695);Object.defineProperty(e,"computeFieldOfView",{enumerable:!0,get:function(){return n.computeFieldOfView}});var s=i(841);Object.defineProperty(e,"CardinalDirection",{enumerable:!0,get:function(){return s.CardinalDirection}}),Object.defineProperty(e,"CardinalDirectionFlags",{enumerable:!0,get:function(){return s.CardinalDirectionFlags}}),Object.defineProperty(e,"Offset",{enumerable:!0,get:function(){return s.Offset}})},702:function(t,e,i){var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return n(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.TileFlags=void 0;const a=s(i(841));var o;(o=e.TileFlags||(e.TileFlags={}))[o.NONE=0]="NONE",o[o.WALL_NORTH=1]="WALL_NORTH",o[o.WALL_EAST=2]="WALL_EAST",o[o.WALL_WEST=8]="WALL_WEST",o[o.WALL_SOUTH=4]="WALL_SOUTH",o[o.BODY=1<<a.CARDINAL_DIRECTIONS.length]="BODY"},101:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.WarpDataCache=void 0,e.WarpDataCache=class{constructor(){this._data={}}get(t,e,i,r){let n=this._data[t.id];n||(this._data[t.id]=n={});let s=n[e];s||(n[e]=s={});let a=s[r];a||(s[r]=a={});let o=a[i];return o||(a[i]=o={map:t,warpCount:e,shiftX:i,shiftY:r},o)}}},720:function(t,e,i){var r=this&&this.__createBinding||(Object.create?function(t,e,i,r){void 0===r&&(r=i),Object.defineProperty(t,r,{enumerable:!0,get:function(){return e[i]}})}:function(t,e,i,r){void 0===r&&(r=i),t[r]=e[i]}),n=this&&this.__setModuleDefault||(Object.create?function(t,e){Object.defineProperty(t,"default",{enumerable:!0,value:e})}:function(t,e){t.default=e}),s=this&&this.__importStar||function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)"default"!==i&&Object.prototype.hasOwnProperty.call(t,i)&&r(e,t,i);return n(e,t),e};Object.defineProperty(e,"__esModule",{value:!0}),e.mergeWedges=e.addWarp=e.addShadow=e.getBestWedge=e.initWedges=void 0;const a=s(i(601));e.initWedges=function(t){return[{low:0,high:Number.POSITIVE_INFINITY,shadow:!1,warp:t}]},e.getBestWedge=function(t,e,i,r){let n,s=Number.POSITIVE_INFINITY;for(const c of t){if(c.low>=r)break;if(c.high<=e)continue;const t=Math.max(i-c.high,c.low-i);n&&(h=c,l=s,d=t,!((o=n).shadow!==h.shadow?o.shadow:!(d>l+a.PICK_WEDGE_EPSILON)&&(l>d+a.PICK_WEDGE_EPSILON||(h.warp.warpCount!==o.warp.warpCount?h.warp.warpCount<o.warp.warpCount:h.warp.map.id!==o.warp.map.id?h.warp.map.id<o.warp.map.id:h.warp.shiftY!==o.warp.shiftY?h.warp.shiftY<o.warp.shiftY:h.warp.shiftX!==o.warp.shiftX&&h.warp.shiftX<o.warp.shiftX))))||(n=c,s=t)}var o,h,l,d;if(!n)throw new Error("[bug] no wedge found");return n},e.addShadow=function(t,e,i){if(t.shadow||i<=t.low||e>=t.high)return[t];if(e<=t.low){if(i>=t.high)return t.shadow=!0,[t];{const e=Object.assign(Object.assign({},t),{shadow:!0,high:i});return t.low=i,[e,t]}}if(i>=t.high){const i=Object.assign(Object.assign({},t),{shadow:!0,low:e});return t.high=e,[t,i]}return[Object.assign(Object.assign({},t),{high:e}),Object.assign(Object.assign({},t),{shadow:!0,low:e,high:i}),Object.assign(Object.assign({},t),{low:i})]},e.addWarp=function(t,e,i,r){if(t.warp===e||r<=t.low||i>=t.high)return[t];if(i<=t.low){if(r>=t.high)return t.warp=e,[t];{const i=Object.assign(Object.assign({},t),{warp:e,high:r});return t.low=r,[i,t]}}if(r>=t.high){const r=Object.assign(Object.assign({},t),{warp:e,low:i});return t.high=i,[t,r]}return[Object.assign(Object.assign({},t),{high:i}),Object.assign(Object.assign({},t),{warp:e,low:i,high:r}),Object.assign(Object.assign({},t),{low:r})]},e.mergeWedges=function(t){if(0===t.length)throw new Error("[bug] no wedges");if(1===t.length)return t;const e=[];for(const n of t)0===e.length||(r=n,(i=e[e.length-1]).shadow!==r.shadow||i.warp!==r.warp)?e.push(n):e[e.length-1].high=n.high;var i,r;return e}}},e={};return function i(r){if(e[r])return e[r].exports;var n=e[r]={exports:{}};return t[r].call(n.exports,n,n.exports,i),n.exports}(607)})();
//# sourceMappingURL=warp-field-2.0.0.min.js.map